<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Daily Hub</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=DM+Mono:wght@400;500&family=Lora:ital,wght@0,500;0,600;1,400&display=swap" rel="stylesheet"/>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body,#root{height:100%;overflow:hidden}
body{font-family:'DM Sans',sans-serif;background:#f5f0eb;color:#2d2a26;font-size:14px}
::-webkit-scrollbar{width:5px}
::-webkit-scrollbar-thumb{background:#d4c9bb;border-radius:4px}
input,textarea,select,button{font-family:inherit}
button{cursor:pointer}
a{text-decoration:none;cursor:pointer}
@keyframes fadeUp{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
.fade{animation:fadeUp .18s ease}
@keyframes spin{to{transform:rotate(360deg)}}
.spin{display:inline-block;animation:spin 1s linear infinite}
@keyframes slideIn{from{opacity:0;transform:scale(.97)}to{opacity:1;transform:scale(1)}}
.modal-in{animation:slideIn .15s ease}

/* Responsive sidebar */
@media(max-width:768px){
  .sidebar{width:48px!important}
  .sidebar .sb-label{display:none!important}
  .main-content{padding:10px!important}
  .two-col{grid-template-columns:1fr!important}
  .three-col{grid-template-columns:1fr!important}
  .notes-grid{grid-template-columns:1fr!important}
}
@media(max-width:480px){
  .stat-grid{grid-template-columns:repeat(2,1fr)!important}
  .card-grid{grid-template-columns:1fr!important}
}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useMemo,useRef,useCallback} = React;

const C={
  bg:"#f5f0eb",sb:"#ede8e0",card:"#fff",border:"#e2d9cf",
  text:"#2d2a26",t2:"#6b6358",t3:"#a89f92",
  accent:"#5b5bd6",cream:"#faf7f4",
  red:"#ef4444",orange:"#f97316",green:"#10b981",
  yellow:"#f59e0b",purple:"#8b5cf6",blue:"#3b82f6",
};

const TEAM=["SS","CZ","JE","ZM","AA","SE","RF","MC","SR","LB","JT","RSJ","LS","KF","SO","OPE Leads","OSP","OA","OAPS","EA","JM","LD", "ZY","ZX"];
const WORKSTREAMS=["OPE: Digest","OPE: Leads",,"OSP: Onboarding","Insight: Insight Upcoming Release","Operations/ OSP Meeting","OSP Team Meeting Prep", "OSP Team Engagement Planning", "Insight: UX & Design", "Insight: Prior to Release", "Insight: Post Release Engagement Tasks", "RESC Monthly Meeting", "OSP: Race & Equity Session", "CZ/SS Check-In Items", "Insight PM/ Engagement Lead Check-In", "OSP: Reorganizing Things", "OSP: Team Member Requests" "Other"];

const SECTIONS=[
  {id:"all",       label:"All",                  icon:"â—ˆ",color:C.accent},
  {id:"supervisor",label:"Supervisor Check-In",   icon:"â—ˆ",color:C.blue,  tag:"Supervisor"},
  {id:"pm",        label:"PM & Engagement",        icon:"â—‰",color:C.purple,tag:"PM"},
  {id:"osp",       label:"OSP Operations",         icon:"â—†",color:C.green, tag:"OSP Ops"},
  {id:"ope",       label:"OPE / OPE Leads",        icon:"â—‡",color:C.yellow,tag:"OPE"},
  {id:"insight",   label:"Insight",                icon:"â—",color:"#ec4899",tag:"Insight"},
  {id:"resc",      label:"RESC",                   icon:"â—‘",color:"#14b8a6",tag:"RESC"},
  {id:"meetings",  label:"Meetings",               icon:"â—·",color:C.red,   tag:"Meeting"},
];

const PRIS=[
  {id:"urgent",label:"Urgent",color:C.red},
  {id:"high",  label:"High",  color:C.orange},
  {id:"normal",label:"Normal",color:C.accent},
  {id:"low",   label:"Low",   color:"#94a3b8"},
];
const STATS=[
  {id:"pending",   label:"Pending",    dot:C.orange},
  {id:"inprogress",label:"In Progress",dot:C.blue},
  {id:"blocked",   label:"Blocked",    dot:C.red},
  {id:"done",      label:"Done",       dot:C.green},
  {id:"archived",  label:"Archived",   dot:"#94a3b8"},
];
const VIEWS=[
  {id:"dashboard",label:"Dashboard",   icon:"ğŸ“Š"},
  {id:"prep",     label:"Meeting Prep",icon:"ğŸ¯"},
  {id:"notes",    label:"Notes",       icon:"ğŸ“"},
  {id:"cards",    label:"Cards",       icon:"â–¦"},
  {id:"decisions",label:"Decision Log",icon:"âš–"},
  {id:"search",   label:"Search",      icon:"ğŸ”"},
  {id:"history",  label:"History",     icon:"ğŸ“š"},
  {id:"archive",  label:"Archive",     icon:"ğŸ—‚"},
  {id:"todo",     label:"To-Do",       icon:"âœ…"},
  {id:"gantt",    label:"Gantt",       icon:"ğŸ“…"},
  {id:"calendar", label:"Calendar",    icon:"ğŸ—“"},
  {id:"monitor",  label:"Monitor",     icon:"ğŸ”—"},
];

const TFIELDS=[
  {key:"agenda",    label:"Agenda / Topics",        icon:"ğŸ“‹",ph:"What was covered..."},
  {key:"decisions", label:"Key Decisions",           icon:"âœ…",ph:"Decisions reached..."},
  {key:"actions",   label:"Action Items (who + due)",icon:"âš¡",ph:"Salma â€” follow up with X by date..."},
  {key:"nextsteps", label:"Next Steps",              icon:"â†’", ph:"What happens next..."},
  {key:"blockers",  label:"Blockers / Dependencies", icon:"âš ", ph:"What's in the way..."},
  {key:"notes",     label:"My Notes / Thoughts",     icon:"ğŸ’­",ph:"Anything else..."},
];

// â”€â”€ 10 MEETING TEMPLATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const TMPLS={
  sscz:{id:"sscz",label:"SS/CZ â€” Supervisor Weekly",section:"supervisor",title:"SS/CZ Supervisor Weekly Check-in",
    attendees:"Salma, CZ",
    agenda:"1. Sprint review â€” what was completed this week\n2. Priorities for the week ahead\n3. Blockers â€” what's in the way\n4. Engagement updates\n5. Onboarding / staffing updates (Allie, open roles)\n6. Support needed from CZ\n7. Additional work / new asks"},

  zmss:{id:"zmss",label:"ZM/SS â€” PM & Engagement Weekly",section:"pm",title:"ZM/SS PM & Engagement Weekly",
    attendees:"Salma, ZM",
    agenda:"1. Sprint status update\n2. Jira board review (TDPGM / SQRT / SQR)\n3. Project updates\n   - Alchemer: Salma to investigate further\n   - Memorializing + aligning survey\n   - Investigate functionalities on each survey\n   - UX feedback capture process\n4. Near future items\n   - Survey fields and locations\n   - What we'd like to generate\n   - How to incorporate UX feedback\n   - UX: Salma as a user + follow-ups\n   - Bugs / resolution\n   - Pool of requests for Insight\n5. Blockers / open questions"},

  zmssje:{id:"zmssje",label:"ZM/SS/JE â€” Monthly Check-in",section:"pm",title:"ZM/SS/JE Monthly Check-in",
    attendees:"Salma, ZM, JE",
    agenda:"1. Monthly progress review\n2. Cross-team updates\n3. Decisions needed\n4. Open questions / alignment"},

  ospops:{id:"ospops",label:"OSP Ops Weekly Check-in",section:"osp",title:"OSP Ops Weekly Check-in",
    attendees:"Salma, Ops team",
    agenda:"1. Contracts update\n   - Survey SY25-26 (PO WR260194173) â€” status\n   - Survey SY26-27 â€” drafting & approval stage\n   - Survey Replacement â€” cost/price analysis, RA\n   - MWBE Peer Consulting (Eugene) â€” 8/3/25â€“8/2/28\n   - MWBE First Tek (Zhenni) â€” 7/1/24â€“6/30/27, ext. request 1/1/27\n   - MWBE VisionaryZ (Sai) â€” 1/8/26â€“1/7/27 extension\n   - MWBE TBD (Sai) â€” vendor transfer, DCP timeline\n2. Budget\n   - Per Session Work â€” timeline, circular status\n   - Survey budget SY26-27 (~100K options)\n   - FY26 spending review\n3. Consultants â€” updates\n4. Interns â€” updates\n5. HR & Staffing\n   - 360s: Eric, Cleo, Sajjad, Tatiana\n   - Backfill for Aurora (DIIT INC2035303)\n   - Exit interviews / Tweed updates\n   - Software / Supplies\n6. Upcoming holidays & union days\n7. Leaves & Accommodations\n8. Decisions that need to be made by OSP and Operations"},

  insight:{id:"insight",label:"Insight Leads Bi-weekly",section:"insight",title:"Insight Leads Bi-weekly",
    attendees:"Japeck, Rachel, Alena, ZM",
    agenda:"What Salma needs to do and has on her radar coming out of this meeting:\n\n- Action items assigned to Salma\n- Items to follow up on\n- Things to keep on radar\n- Decisions Salma needs to flag or escalate"},

  uxdesign:{id:"uxdesign",label:"Insight UX/Design Weekly",section:"insight",title:"Insight UX/Design Weekly",
    attendees:"Salma, ZM, Mike, Sai, Luke, Rachel",
    agenda:"Salma's action items and next steps:\n\n- What Salma needs to do before next meeting\n- Items to follow up on\n- Design decisions pending Salma's input\n- Next steps owned by Salma"},

  resc:{id:"resc",label:"RESC Monthly Meeting",section:"resc",title:"RESC Monthly Meeting",
    attendees:"Salma + 10 RESC members",
    agenda:"What Salma needs to do coming out of this meeting:\n\n- Action items assigned to Salma\n- Follow-ups and deadlines\n- Items to escalate or flag to team\n- Things to keep on radar"},

  opeleads:{id:"opeleads",label:"OPE Leads Weekly Meeting",section:"ope",title:"OPE / OPE Leads Weekly Meeting",
    attendees:"OPE Leads, OSP, OA, OAPS",
    agenda:"1. Priorities for the week\n2. OPE Digest â€” status & content needs\n3. Events & engagement updates\n4. RESC / Race & Equity session updates\n5. Comms & calendar alignment\n6. Open questions"},

  opeinperson:{id:"opeinperson",label:"OPE Leads In-Person Planning",section:"ope",title:"OPE Leads In-Person Planning",
    attendees:"OPE Leads, Salma",
    agenda:"What Salma needs to do coming out of this meeting:\n\n- Planning items assigned to Salma\n- Logistics to follow up on\n- Decisions to confirm\n- Next steps before the event"},

  march23:{id:"march23",label:"OPE Leads In-Person â€” March 23",section:"ope",title:"OPE Leads In-Person â€” March 23",
    attendees:"OPE Leads",
    agenda:""},
};

const ALL_TMPLS=Object.values(TMPLS);

const DOE_HOLIDAYS=[
  {date:"2026-03-20",label:"Eid al-Fitr",type:"holiday"},
  {date:"2026-04-02",label:"Passover / Good Friday",type:"holiday"},
  {date:"2026-04-03",label:"Good Friday",type:"holiday"},
  {date:"2026-03-30",label:"Spring Recess",type:"break"},
  {date:"2026-03-31",label:"Spring Recess",type:"break"},
  {date:"2026-04-01",label:"Spring Recess",type:"break"},
  {date:"2026-04-02",label:"Spring Recess",type:"break"},
  {date:"2026-04-03",label:"Spring Recess",type:"break"},
  {date:"2026-04-10",label:"Spring Recess ends",type:"break"},
  {date:"2026-05-25",label:"Memorial Day",type:"holiday"},
  {date:"2026-05-27",label:"Eid al-Adha",type:"holiday"},
  {date:"2026-06-19",label:"Juneteenth",type:"holiday"},
];

const DEF_SETTINGS={
  jiraBoards:[
    {id:1,name:"TDPGM",base:"https://doeord.atlassian.net/browse",prefix:"TDPGM"},
    {id:2,name:"SQRT", base:"https://doeord.atlassian.net/browse",prefix:"SQRT"},
    {id:3,name:"SQR",  base:"https://doeord.atlassian.net/browse",prefix:"SQR"},
  ],
  zendeskBoards:[{id:1,name:"OSP Helpdesk",base:"https://doeord.zendesk.com"}],
  slackChannels:[{id:1,name:"#osp-team",workspace:"",channel:"osp-team"},{id:2,name:"#ope-leads",workspace:"",channel:"ope-leads"}],
  teamsChannels:[{id:1,name:"OSP General",url:"https://teams.microsoft.com"},{id:2,name:"Insight Team",url:"https://teams.microsoft.com"}],
  importantDates:[
    {id:1,date:"2026-03-16",label:"Allie starts",type:"custom"},
    {id:2,date:"2026-02-28",label:"Performance Review due",type:"deadline"},
    {id:3,date:"2026-03-23",label:"OPE Leads In-Person",type:"custom"},
  ],
  showDOE:true,
  calendarEvents:[],
};

const SAMPLE=[
  {id:1,section:"pm",title:"Alchemer investigation",workstream:"PM Engagement",agenda:"SS to investigate Alchemer further",decisions:"",actions:"Salma â€” investigate Alchemer functionalities",nextsteps:"Compare survey tools, document findings",blockers:"",notes:"Memorializing + aligning survey. Investigate functionalities on each survey.",priority:"high",status:"pending",owner:"Salma",jira:"",startDate:"2026-02-26",due:"2026-03-07",carryOver:true,date:"2026-02-26",type:"checkin",linkedItems:[]},
  {id:2,section:"osp",title:"Onboarding â€” Allie (starts 3/16)",workstream:"Onboarding â€” Allie",agenda:"Review onboarding checklist",decisions:"Salma to own access coordination",actions:"Salma â€” confirm seat 37 with Heather",nextsteps:"Create onboarding calendar invite",blockers:"Seat in discussion",notes:"hbernstein4@schools.nyc.gov â€” Allie's email. Fingerprinting 2/20.",priority:"high",status:"pending",owner:"Salma",jira:"",startDate:"2026-02-23",due:"2026-03-16",carryOver:true,date:"2026-02-23",type:"checkin",linkedItems:[]},
  {id:3,section:"supervisor",title:"OSP Performance Review",workstream:"Performance Reviews",agenda:"360 review process + timeline",decisions:"Complete by end of Feb",actions:"Salma â€” follow up on 360 framework",nextsteps:"Complete self-evaluation",blockers:"Waiting on OPS for framework",notes:"360s: Eric, Cleo, Sajjad, Tatiana are targets",priority:"high",status:"pending",owner:"Salma",jira:"",startDate:"2026-01-26",due:"2026-02-28",carryOver:true,date:"2026-01-26",type:"checkin",linkedItems:[]},
  {id:4,section:"osp",title:"MWBE TBD â€” vendor transfer",workstream:"Contracts",agenda:"Sai reached out to new vendor from MWBE list",decisions:"",actions:"Jon â€” speak with vendor re: higher rate request",nextsteps:"DCP to notify of timeline",blockers:"DCP almost ready to release",notes:"K Systems Solutions Sales: sales@kssnyc.co",priority:"normal",status:"inprogress",owner:"Salma",jira:"",startDate:"2026-02-01",due:"2026-03-15",carryOver:true,date:"2026-02-01",type:"checkin",linkedItems:[]},
  {id:5,section:"ope",title:"OPE Leads In-Person â€” March 23",workstream:"OPE Leads In-Person Event",agenda:"Planning for March 23 in-person event",decisions:"",actions:"Salma â€” confirm logistics by 3/1",nextsteps:"Send calendar invite to all attendees",blockers:"",notes:"",priority:"high",status:"pending",owner:"Salma",jira:"",startDate:"2026-02-24",due:"2026-03-23",carryOver:true,date:"2026-02-24",type:"checkin",linkedItems:[]},
];

const SAMPLE_TODOS=[
  {id:101,text:"Follow up with Heather re: Allie's seat 37",done:false,date:today()},
  {id:102,text:"Review Zendesk helpdesk queue",done:false,date:today()},
  {id:103,text:"Confirm OPE Leads March 23 logistics",done:false,date:today()},
];

const SAMPLE_DECISIONS=[
  {id:1,text:"Performance review 360s: Eric, Cleo, Sajjad, Tatiana are targets",meeting:"SS/CZ Supervisor Weekly",date:"2026-02-19",section:"supervisor",owner:"Salma",status:"open"},
  {id:2,text:"Survey replacement contract term: 4 years + 2 one-year options",meeting:"OSP Ops Weekly",date:"2026-02-12",section:"osp",owner:"Salma",status:"open"},
  {id:3,text:"Allie's start date updated to 3/16",meeting:"OSP Ops Weekly",date:"2026-02-26",section:"osp",owner:"Salma",status:"open"},
];

function today(){return new Date().toISOString().split("T")[0];}
function lastWeek(){const d=new Date();d.setDate(d.getDate()-7);return d.toISOString().split("T")[0];}
function fmt(d){if(!d)return"";return new Date(d+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"});}
function fmtFull(d){if(!d)return"";return new Date(d+"T00:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"});}
function isOD(due){return due&&new Date(due+"T00:00:00")<new Date(new Date().toDateString());}
function isSoon(due){if(!due)return false;const diff=(new Date(due+"T00:00:00")-new Date(new Date().toDateString()))/86400000;return diff>=0&&diff<=3;}
function lsGet(k,fb){try{const v=localStorage.getItem(k);return v?JSON.parse(v):fb;}catch{return fb;}}
function lsSave(k,v){try{localStorage.setItem(k,JSON.stringify(v));}catch{}}
function getPri(id){return PRIS.find(p=>p.id===id)||PRIS[2];}
function getStat(id){return STATS.find(s=>s.id===id)||STATS[0];}
function getSec(id){return SECTIONS.find(s=>s.id===id)||SECTIONS[1];}
function hl(text,q){
  if(!q||!text)return text;
  const i=text.toLowerCase().indexOf(q.toLowerCase());
  if(i===-1)return text;
  return <>{text.slice(0,i)}<mark style={{background:"#fde68a",borderRadius:2}}>{text.slice(i,i+q.length)}</mark>{text.slice(i+q.length)}</>;
}

// â”€â”€ SHARED UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Tag({c,label}){
  return <span style={{fontSize:10,fontWeight:600,color:c,background:c+"18",padding:"2px 7px",borderRadius:20,border:`1px solid ${c}28`,whiteSpace:"nowrap"}}>{label}</span>;
}
function Lbl({children}){return <div style={{fontSize:10,color:C.t3,fontWeight:700,letterSpacing:"0.07em",marginBottom:4}}>{children}</div>;}
function Datalists(){return<><datalist id="team">{TEAM.map(n=><option key={n} value={n}/>)}</datalist><datalist id="ws">{WORKSTREAMS.map(w=><option key={w} value={w}/>)}</datalist></>;}
const inp0={width:"100%",background:C.cream,border:`1px solid ${C.border}`,borderRadius:8,padding:"8px 11px",color:C.text,fontSize:13,outline:"none"};

// â”€â”€ ICS PARSER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function parseICS(text){
  const events=[];
  const blocks=text.split("BEGIN:VEVENT");
  blocks.slice(1).forEach(block=>{
    const get=key=>{const m=block.match(new RegExp(`${key}[^:]*:([^\\r\\n]+)`));return m?m[1].trim():"";};
    const dtstart=get("DTSTART");
    const summary=get("SUMMARY");
    const desc=get("DESCRIPTION");
    const loc=get("LOCATION");
    if(!summary)return;
    let date="";
    if(dtstart){
      const d=dtstart.replace(/T.*/,"");
      if(d.length===8)date=`${d.slice(0,4)}-${d.slice(4,6)}-${d.slice(6,8)}`;
    }
    events.push({id:Date.now()+Math.random(),summary,date,description:desc,location:loc,imported:true});
  });
  return events;
}

// â”€â”€ ITEM CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ItemCard({item,settings,onEdit,onDelete,onCycle,onArchive,all,q=""}){
  const pri=getPri(item.priority),sta=getStat(item.status),sec=getSec(item.section);
  const od=isOD(item.due),soon=isSoon(item.due)&&!od;
  const jb=(settings.jiraBoards||[]).find(b=>item.jira?.toUpperCase().startsWith(b.prefix.toUpperCase()));
  const jLink=jb?`${jb.base}/${item.jira}`:null;
  const linked=(item.linkedItems||[]).map(id=>all.find(i=>i.id===id)).filter(Boolean);
  return(
    <div className="fade" style={{background:C.card,border:`1px solid ${od?C.red+"66":soon?"#fde68a":C.border}`,borderRadius:12,padding:"13px 15px",position:"relative",borderLeft:`3px solid ${sec.color}`}}>
      <div style={{paddingRight:52,marginBottom:4}}>
        <div style={{fontSize:13,fontWeight:600,color:C.text,lineHeight:1.4,marginBottom:2}}>{q?hl(item.title,q):item.title}</div>
        {item.workstream&&<div style={{fontSize:10,color:C.t3}}>ğŸ“ {item.workstream}</div>}
        {item.attendees&&<div style={{fontSize:10,color:C.t3}}>ğŸ‘¥ {item.attendees}</div>}
      </div>
      {TFIELDS.filter(f=>item[f.key]?.trim()).slice(0,3).map(f=>(
        <div key={f.key} style={{marginBottom:3}}>
          <span style={{fontSize:10,fontWeight:700,color:C.t3,textTransform:"uppercase",letterSpacing:"0.05em"}}>{f.icon} {f.label}: </span>
          <span style={{fontSize:11,color:C.t2}}>{q?hl((item[f.key]||"").slice(0,90),q):(item[f.key]||"").slice(0,90)}{(item[f.key]||"").length>90?"â€¦":""}</span>
        </div>
      ))}
      {linked.length>0&&(
        <div style={{marginTop:6,padding:"5px 8px",background:C.cream,borderRadius:7,border:`1px solid ${C.border}`}}>
          <div style={{fontSize:9,fontWeight:700,color:C.t3,letterSpacing:"0.05em",marginBottom:2}}>ğŸ”— LINKED</div>
          {linked.map(li=>(
            <div key={li.id} style={{fontSize:11,color:C.t2,display:"flex",gap:5,alignItems:"center",marginBottom:2}}>
              <span style={{color:getSec(li.section).color}}>{getSec(li.section).icon}</span>
              <span style={{flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{li.title}</span>
              <Tag c={getStat(li.status).dot} label={getStat(li.status).label}/>
            </div>
          ))}
        </div>
      )}
      <div style={{display:"flex",flexWrap:"wrap",gap:4,marginTop:8}}>
        <Tag c={pri.color} label={pri.label.toUpperCase()}/>
        <span onClick={()=>onCycle&&onCycle(item)} style={{fontSize:10,fontWeight:600,color:C.t2,background:C.bg,padding:"2px 7px",borderRadius:20,border:`1px solid ${C.border}`,display:"inline-flex",alignItems:"center",gap:3,cursor:onCycle?"pointer":"default"}}>
          <span style={{width:6,height:6,borderRadius:"50%",background:sta.dot,display:"inline-block"}}/>{sta.label}
        </span>
        <Tag c={sec.color} label={sec.tag||sec.label}/>
        {item.startDate&&item.due&&item.startDate!==item.due&&<span style={{fontSize:9,color:C.t3,background:C.cream,padding:"2px 6px",borderRadius:20,border:`1px solid ${C.border}`}}>{fmt(item.startDate)} â†’ {fmt(item.due)}</span>}
        {item.due&&(!item.startDate||item.startDate===item.due)&&(
          <span style={{fontSize:9,fontWeight:600,color:od?C.red:soon?C.yellow:C.t3,background:od?"#fef2f2":soon?"#fffbeb":C.cream,padding:"2px 6px",borderRadius:20,border:`1px solid ${od?"#fca5a8":soon?"#fde68a":C.border}`}}>
            {od?"â° ":soon?"â± ":""}{fmt(item.due)}
          </span>
        )}
        {item.carryOver&&item.status!=="done"&&<Tag c={C.yellow} label="â†» Carry"/>}
        {item.jira&&<a href={jLink||"#"} target="_blank" rel="noopener noreferrer" style={{fontSize:10,color:C.blue,background:C.blue+"15",padding:"2px 7px",borderRadius:20,border:`1px solid ${C.blue}33`,fontWeight:600}}>â¬¡ {item.jira} â†—</a>}
      </div>
      <div style={{position:"absolute",top:9,right:7,display:"flex",gap:1}}>
        {onEdit&&<button onClick={()=>onEdit(item)} style={{background:"transparent",border:"none",color:C.t3,fontSize:13,padding:"2px 3px"}}>âœ</button>}
        {onArchive&&item.status==="done"&&<button onClick={()=>onArchive(item.id)} title="Archive" style={{background:"transparent",border:"none",color:C.t3,fontSize:11,padding:"2px 3px"}}>ğŸ—‚</button>}
        {onDelete&&<button onClick={()=>onDelete(item.id)} style={{background:"transparent",border:"none",color:C.t3,fontSize:11,padding:"2px 3px"}}>âœ•</button>}
      </div>
    </div>
  );
}

// â”€â”€ POST-MEETING DEBRIEF â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function PostMeetingDebrief({items, onSave, onClose, initTmpl}){
  const [step, setStep] = useState(initTmpl?1:0); // 0=pick meeting, 1=fill form
  const [selTmpl, setSelTmpl] = useState(initTmpl||ALL_TMPLS[0].id);
  const tmpl = TMPLS[selTmpl] || ALL_TMPLS[0];
  const sec = getSec(tmpl.section);

  // Form state â€” each section is a list of line items
  const [decisions,   setDecisions]   = useState([{id:1,text:""}]);
  const [actions,     setActions]     = useState([{id:1,text:"",due:"",priority:"normal"}]);
  const [radar,       setRadar]       = useState([{id:1,text:""}]);
  const [notes,       setNotes]       = useState("");
  const [updateCards, setUpdateCards] = useState([]); // ids of items to mark updated
  const [saved,       setSaved]       = useState(false);

  const activeItems = items.filter(i=>i.section===tmpl.section&&i.status!=="done"&&i.status!=="archived");

  function addRow(setter){ setter(r=>[...r,{id:Date.now(),text:"",due:"",priority:"normal"}]); }
  function delRow(setter,id){ setter(r=>r.filter(x=>x.id!==id)); }
  function upRow(setter,id,k,v){ setter(r=>r.map(x=>x.id===id?{...x,[k]:v}:x)); }

  function processAndSave(){
    const out = {items:[], decisions:[], todos:[]};
    const meetingTitle = `${tmpl.title} â€” ${fmt(today())}`;

    // Decisions â†’ Decision Log
    decisions.filter(d=>d.text.trim()).forEach(d=>{
      out.decisions.push({id:Date.now()+Math.random(),text:d.text.trim(),meeting:tmpl.title,date:today(),section:tmpl.section,owner:"Salma",status:"open"});
    });

    // Action items â†’ Cards
    actions.filter(a=>a.text.trim()).forEach(a=>{
      out.items.push({id:Date.now()+Math.random(),section:tmpl.section,title:a.text.trim(),workstream:"",agenda:"",decisions:"",actions:a.text.trim(),nextsteps:"",blockers:"",notes:"",priority:a.priority||"normal",status:"pending",owner:"Salma",jira:"",startDate:today(),due:a.due||"",carryOver:true,date:today(),type:"checkin",linkedItems:[],attendees:""});
    });

    // Radar â†’ carry-over cards (low priority)
    radar.filter(r=>r.text.trim()).forEach(r=>{
      out.items.push({id:Date.now()+Math.random(),section:tmpl.section,title:"ğŸ‘ "+r.text.trim(),workstream:"",agenda:"",decisions:"",actions:"",nextsteps:r.text.trim(),blockers:"",notes:"",priority:"low",status:"pending",owner:"Salma",jira:"",startDate:today(),due:"",carryOver:true,date:today(),type:"checkin",linkedItems:[],attendees:""});
    });

    // Notes â†’ single summary card if filled
    if(notes.trim()){
      out.items.push({id:Date.now()+Math.random(),section:tmpl.section,title:`Notes: ${meetingTitle}`,workstream:"",agenda:"",decisions:"",actions:"",nextsteps:"",blockers:"",notes:notes.trim(),priority:"low",status:"done",owner:"Salma",jira:"",startDate:today(),due:"",carryOver:false,date:today(),type:"meeting",linkedItems:[],attendees:tmpl.attendees||""});
    }

    onSave(out, updateCards);
    setSaved(true);
    setTimeout(()=>onClose(), 1200);
  }

  const Section = ({color,icon,label,sub,children}) => (
    <div style={{background:C.card,border:`1px solid ${color}33`,borderRadius:12,padding:"14px 16px",borderLeft:`3px solid ${color}`}}>
      <div style={{display:"flex",alignItems:"baseline",gap:7,marginBottom:3}}>
        <span style={{fontSize:14}}>{icon}</span>
        <div style={{fontSize:13,fontWeight:700,color:C.text}}>{label}</div>
      </div>
      {sub&&<div style={{fontSize:11,color:C.t3,marginBottom:10}}>{sub}</div>}
      {children}
    </div>
  );

  const LineInput = ({value,onChange,placeholder,onDelete,showDelete}) => (
    <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:5}}>
      <span style={{color:C.t3,fontSize:12,flexShrink:0}}>â€¢</span>
      <input value={value} onChange={onChange} placeholder={placeholder}
        style={{flex:1,background:C.cream,border:`1px solid ${C.border}`,borderRadius:7,padding:"7px 10px",color:C.text,fontSize:13,outline:"none"}}/>
      {showDelete&&<button onClick={onDelete} style={{background:"transparent",border:"none",color:C.t3,fontSize:13,flexShrink:0}}>âœ•</button>}
    </div>
  );

  if(saved) return(
    <div style={{position:"fixed",inset:0,background:"#00000044",display:"flex",alignItems:"center",justifyContent:"center",zIndex:400}}>
      <div className="modal-in" style={{background:C.card,borderRadius:16,padding:"36px 40px",textAlign:"center",boxShadow:"0 20px 60px #0002"}}>
        <div style={{fontSize:40,marginBottom:12}}>âœ…</div>
        <div style={{fontSize:16,fontWeight:700,color:C.text,marginBottom:4}}>Meeting logged!</div>
        <div style={{fontSize:12,color:C.t3}}>Cards, decisions and radar items saved.</div>
      </div>
    </div>
  );

  return(
    <div style={{position:"fixed",inset:0,background:"#00000055",display:"flex",alignItems:"center",justifyContent:"center",zIndex:400,padding:16,overflowY:"auto"}} onClick={e=>{if(e.target===e.currentTarget)onClose();}}>
      <div className="modal-in" style={{background:C.bg,border:`1px solid ${C.border}`,borderRadius:18,width:"100%",maxWidth:620,maxHeight:"94vh",overflowY:"auto",boxShadow:"0 24px 64px #0003",display:"flex",flexDirection:"column"}}>

        {/* Header */}
        <div style={{padding:"16px 20px 12px",borderBottom:`1px solid ${C.border}`,background:C.card,borderRadius:"18px 18px 0 0",flexShrink:0}}>
          <div style={{display:"flex",alignItems:"center",justifyContent:"space-between"}}>
            <div>
              <div style={{fontSize:15,fontWeight:700,color:C.text,fontFamily:"'Lora',serif"}}>ğŸ“‹ Post-Meeting Debrief</div>
              <div style={{fontSize:11,color:C.t3,marginTop:2}}>Log what came out of the meeting â€” it'll sort itself.</div>
            </div>
            <button onClick={onClose} style={{background:"transparent",border:"none",color:C.t3,fontSize:18,padding:"0 4px"}}>âœ•</button>
          </div>
          {step===1&&(
            <div style={{marginTop:10,padding:"8px 12px",background:sec.color+"12",border:`1px solid ${sec.color}33`,borderRadius:9,display:"flex",alignItems:"center",gap:9}}>
              <span style={{fontSize:16,color:sec.color}}>{sec.icon}</span>
              <div>
                <div style={{fontSize:13,fontWeight:600,color:sec.color}}>{tmpl.title}</div>
                {tmpl.attendees&&<div style={{fontSize:10,color:C.t3}}>ğŸ‘¥ {tmpl.attendees}</div>}
              </div>
              <button onClick={()=>setStep(0)} style={{marginLeft:"auto",fontSize:10,color:C.t3,background:"transparent",border:`1px solid ${C.border}`,borderRadius:5,padding:"2px 7px"}}>Change</button>
            </div>
          )}
        </div>

        {/* Step 0: Pick meeting */}
        {step===0&&(
          <div style={{padding:"18px 20px",flex:1}}>
            <div style={{fontSize:12,fontWeight:600,color:C.t2,marginBottom:12}}>Which meeting just ended?</div>
            <div style={{display:"flex",flexDirection:"column",gap:6}}>
              {ALL_TMPLS.map(t=>{
                const s=getSec(t.section),act=selTmpl===t.id;
                return(
                  <button key={t.id} onClick={()=>setSelTmpl(t.id)}
                    style={{display:"flex",alignItems:"center",gap:10,padding:"11px 13px",borderRadius:10,border:`1px solid ${act?s.color:C.border}`,background:act?s.color+"12":C.card,textAlign:"left",transition:"all .12s"}}>
                    <span style={{fontSize:15,color:s.color,flexShrink:0}}>{s.icon}</span>
                    <div style={{flex:1}}>
                      <div style={{fontSize:13,fontWeight:act?600:400,color:act?s.color:C.text}}>{t.label}</div>
                      {t.attendees&&<div style={{fontSize:10,color:C.t3}}>ğŸ‘¥ {t.attendees}</div>}
                    </div>
                    {act&&<span style={{color:s.color,fontSize:14}}>âœ“</span>}
                  </button>
                );
              })}
            </div>
            <button onClick={()=>setStep(1)} style={{width:"100%",marginTop:14,padding:"11px",borderRadius:10,border:"none",background:C.accent,color:"#fff",fontSize:14,fontWeight:600}}>
              Continue â†’ Fill Debrief
            </button>
          </div>
        )}

        {/* Step 1: Fill form */}
        {step===1&&(
          <div style={{padding:"16px 20px",display:"flex",flexDirection:"column",gap:12,flex:1}}>

            {/* Decisions */}
            <Section color={C.purple} icon="âš–" label="Decisions Made" sub="What was decided in this meeting?">
              {decisions.map((d,i)=>(
                <LineInput key={d.id} value={d.text} onChange={e=>upRow(setDecisions,d.id,"text",e.target.value)}
                  placeholder="e.g. Contract term set to 4 years + 2 options"
                  onDelete={()=>delRow(setDecisions,d.id)} showDelete={decisions.length>1}/>
              ))}
              <button onClick={()=>addRow(setDecisions)} style={{fontSize:11,color:C.purple,background:"transparent",border:`1px dashed ${C.purple}44`,borderRadius:6,padding:"4px 10px",width:"100%",marginTop:3}}>+ Add decision</button>
            </Section>

            {/* Action items */}
            <Section color={C.accent} icon="âš¡" label="My Action Items" sub="What does Salma need to do?">
              {actions.map((a,i)=>(
                <div key={a.id} style={{marginBottom:7}}>
                  <div style={{display:"flex",gap:6,alignItems:"center",marginBottom:4}}>
                    <span style={{color:C.t3,fontSize:12,flexShrink:0}}>â€¢</span>
                    <input value={a.text} onChange={e=>upRow(setActions,a.id,"text",e.target.value)} placeholder="e.g. Follow up with Jon on vendor transfer"
                      style={{flex:1,background:C.cream,border:`1px solid ${C.border}`,borderRadius:7,padding:"7px 10px",color:C.text,fontSize:13,outline:"none"}}/>
                    {actions.length>1&&<button onClick={()=>delRow(setActions,a.id)} style={{background:"transparent",border:"none",color:C.t3,fontSize:13}}>âœ•</button>}
                  </div>
                  <div style={{display:"flex",gap:6,paddingLeft:18}}>
                    <input type="date" value={a.due} onChange={e=>upRow(setActions,a.id,"due",e.target.value)}
                      style={{flex:1,background:C.cream,border:`1px solid ${C.border}`,borderRadius:7,padding:"5px 9px",color:C.text,fontSize:11,outline:"none"}}/>
                    <select value={a.priority} onChange={e=>upRow(setActions,a.id,"priority",e.target.value)}
                      style={{flex:1,background:C.cream,border:`1px solid ${C.border}`,borderRadius:7,padding:"5px 9px",color:C.text,fontSize:11,outline:"none"}}>
                      {PRIS.map(p=><option key={p.id} value={p.id}>{p.label}</option>)}
                    </select>
                  </div>
                </div>
              ))}
              <button onClick={()=>addRow(setActions)} style={{fontSize:11,color:C.accent,background:"transparent",border:`1px dashed ${C.accent}44`,borderRadius:6,padding:"4px 10px",width:"100%",marginTop:2}}>+ Add action item</button>
            </Section>

            {/* On my radar */}
            <Section color={C.yellow} icon="ğŸ‘" label="On My Radar" sub="Things to watch, follow up on, or keep in mind">
              {radar.map((r,i)=>(
                <LineInput key={r.id} value={r.text} onChange={e=>upRow(setRadar,r.id,"text",e.target.value)}
                  placeholder="e.g. DCP timeline for vendor transfer"
                  onDelete={()=>delRow(setRadar,r.id)} showDelete={radar.length>1}/>
              ))}
              <button onClick={()=>addRow(setRadar)} style={{fontSize:11,color:C.yellow,background:"transparent",border:`1px dashed ${C.yellow}66`,borderRadius:6,padding:"4px 10px",width:"100%",marginTop:3}}>+ Add radar item</button>
            </Section>

            {/* Update existing cards */}
            {activeItems.length>0&&(
              <Section color={C.green} icon="ğŸ”„" label="Update Existing Cards" sub="Mark any open items from this section that were discussed or updated">
                <div style={{maxHeight:140,overflowY:"auto"}}>
                  {activeItems.map(item=>{
                    const checked=updateCards.includes(item.id);
                    return(
                      <div key={item.id} onClick={()=>setUpdateCards(c=>checked?c.filter(id=>id!==item.id):[...c,item.id])}
                        style={{display:"flex",alignItems:"center",gap:8,padding:"6px 8px",borderRadius:7,marginBottom:3,background:checked?C.green+"12":C.cream,border:`1px solid ${checked?C.green+"44":C.border}`,cursor:"pointer"}}>
                        <div style={{width:15,height:15,borderRadius:4,border:`2px solid ${checked?C.green:C.border}`,background:checked?C.green:"transparent",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0}}>
                          {checked&&<span style={{color:"#fff",fontSize:9}}>âœ“</span>}
                        </div>
                        <span style={{fontSize:12,color:C.text,flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{item.title}</span>
                        <Tag c={getPri(item.priority).color} label={getPri(item.priority).label}/>
                      </div>
                    );
                  })}
                </div>
                {updateCards.length>0&&<div style={{fontSize:11,color:C.green,marginTop:6,fontWeight:600}}>âœ“ {updateCards.length} item{updateCards.length>1?"s":""} will be marked In Progress</div>}
              </Section>
            )}

            {/* Notes */}
            <Section color={C.t3} icon="ğŸ’­" label="Notes / Context" sub="Anything else worth capturing">
              <textarea value={notes} onChange={e=>setNotes(e.target.value)} placeholder="Any other context, colour, or things that didn't fit aboveâ€¦"
                rows={3} style={{width:"100%",background:C.cream,border:`1px solid ${C.border}`,borderRadius:8,padding:"8px 11px",color:C.text,fontSize:13,outline:"none",resize:"vertical",lineHeight:1.7}}/>
            </Section>

            {/* Save bar */}
            <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:12,padding:"13px 16px",display:"flex",alignItems:"center",justifyContent:"space-between",gap:10,flexWrap:"wrap"}}>
              <div style={{fontSize:12,color:C.t3}}>
                Will create: <strong style={{color:C.accent}}>{actions.filter(a=>a.text.trim()).length} cards</strong>
                {decisions.filter(d=>d.text.trim()).length>0&&<> Â· <strong style={{color:C.purple}}>{decisions.filter(d=>d.text.trim()).length} decisions</strong></>}
                {radar.filter(r=>r.text.trim()).length>0&&<> Â· <strong style={{color:C.yellow}}>{radar.filter(r=>r.text.trim()).length} radar items</strong></>}
              </div>
              <div style={{display:"flex",gap:8}}>
                <button onClick={onClose} style={{padding:"8px 14px",borderRadius:8,border:`1px solid ${C.border}`,background:"transparent",color:C.t2,fontSize:13}}>Cancel</button>
                <button onClick={processAndSave} style={{padding:"8px 20px",borderRadius:8,border:"none",background:C.accent,color:"#fff",fontSize:13,fontWeight:700}}>Process & Save â†’</button>
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

// â”€â”€ QUICK CAPTURE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function QuickCapture({onSave,onClose}){
  const [text,setText]=useState("");
  const [type,setType]=useState("todo");
  const [section,setSection]=useState("all");
  const ref=useRef();
  useEffect(()=>ref.current?.focus(),[]);
  function save(){
    if(!text.trim())return;
    if(type==="todo"){onSave("todo",{id:Date.now(),text:text.trim(),done:false,date:today()});}
    else if(type==="note"){onSave("item",{id:Date.now(),section:section==="all"?"supervisor":section,title:text.trim(),workstream:"",agenda:text.trim(),decisions:"",actions:"",nextsteps:"",blockers:"",notes:"",priority:"normal",status:"pending",owner:"Salma",jira:"",startDate:today(),due:"",carryOver:true,date:today(),type:"checkin",linkedItems:[],attendees:""});}
    else if(type==="decision"){onSave("decision",{id:Date.now(),text:text.trim(),meeting:"Quick Capture",date:today(),section:section==="all"?"supervisor":section,owner:"Salma",status:"open"});}
    onClose();
  }
  return(
    <div style={{position:"fixed",inset:0,background:"#00000044",display:"flex",alignItems:"center",justifyContent:"center",zIndex:400,padding:20}} onClick={e=>{if(e.target===e.currentTarget)onClose();}}>
      <div className="modal-in" style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:16,padding:22,width:"100%",maxWidth:460,boxShadow:"0 20px 60px #0002"}}>
        <div style={{fontSize:15,fontWeight:700,color:C.text,marginBottom:14}}>âš¡ Quick Capture</div>
        <div style={{display:"flex",gap:7,marginBottom:13}}>
          {[{id:"todo",label:"âœ… Task"},{id:"note",label:"ğŸ“ Note"},{id:"decision",label:"âš– Decision"}].map(t=>(
            <button key={t.id} onClick={()=>setType(t.id)} style={{flex:1,padding:"7px",borderRadius:8,border:`1px solid ${type===t.id?C.accent:C.border}`,background:type===t.id?C.accent+"18":"transparent",color:type===t.id?C.accent:C.t2,fontSize:12,fontWeight:type===t.id?600:400}}>{t.label}</button>
          ))}
        </div>
        {(type==="note"||type==="decision")&&(
          <div style={{marginBottom:10}}>
            <Lbl>SECTION</Lbl>
            <select value={section} onChange={e=>setSection(e.target.value)} style={{...inp0,marginBottom:0}}>
              {SECTIONS.map(s=><option key={s.id} value={s.id}>{s.label}</option>)}
            </select>
          </div>
        )}
        <textarea ref={ref} value={text} onChange={e=>setText(e.target.value)}
          onKeyDown={e=>{if(e.key==="Enter"&&e.metaKey)save();}}
          placeholder={type==="todo"?"What needs to be done?":type==="note"?"Capture your thought or note...":"What decision was made?"}
          rows={4} style={{width:"100%",background:C.cream,border:`1px solid ${C.border}`,borderRadius:9,padding:"10px 12px",color:C.text,fontSize:14,outline:"none",resize:"none",lineHeight:1.7,marginBottom:12}}/>
        <div style={{display:"flex",gap:9}}>
          <button onClick={onClose} style={{flex:1,padding:"9px",borderRadius:8,border:`1px solid ${C.border}`,background:"transparent",color:C.t2,fontSize:13}}>Cancel</button>
          <button onClick={save} disabled={!text.trim()} style={{flex:2,padding:"9px",borderRadius:8,border:"none",background:text.trim()?C.accent:"#d4c9bb",color:"#fff",fontSize:13,fontWeight:600}}>Save âŒ˜â†µ</button>
        </div>
        <div style={{fontSize:10,color:C.t3,textAlign:"center",marginTop:7}}>Press âŒ˜ + Enter to save quickly</div>
      </div>
    </div>
  );
}

// â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Dashboard({items,todos,decisions,onEdit,settings,onNav,onDebrief}){
  const active=items.filter(i=>i.status!=="archived");
  const td=today();
  const overdue=active.filter(i=>i.status!=="done"&&isOD(i.due));
  const soon=active.filter(i=>i.status!=="done"&&isSoon(i.due)&&!isOD(i.due));
  const blocked=active.filter(i=>i.status==="blocked");
  const inprog=active.filter(i=>i.status==="inprogress");
  const todayTodos=todos.filter(t=>t.date===td);
  const doneTodos=todayTodos.filter(t=>t.done).length;
  const alertItems=[...overdue,...soon].slice(0,8);
  const openDecisions=decisions.filter(d=>d.status==="open");
  const bySec=SECTIONS.filter(s=>s.id!=="all").map(s=>({...s,open:active.filter(i=>i.section===s.id&&i.status!=="done").length,total:active.filter(i=>i.section===s.id).length}));
  const hour=new Date().getHours();
  const greeting=hour<12?"Good morning":hour<17?"Good afternoon":"Good evening";
  const Stat=({label,val,color,sub,click})=>(
    <div onClick={click} style={{background:C.card,border:`1px solid ${C.border}`,borderLeft:`3px solid ${color}`,borderRadius:10,padding:"12px 14px",cursor:click?"pointer":"default"}}>
      <div style={{fontSize:22,fontWeight:700,color}}>{val}</div>
      <div style={{fontSize:12,color:C.t2,fontWeight:600,marginTop:1}}>{label}</div>
      {sub&&<div style={{fontSize:10,color:C.t3,marginTop:1}}>{sub}</div>}
    </div>
  );
  return(
    <div style={{display:"flex",flexDirection:"column",gap:15}}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:9}}>
        <div style={{fontSize:16,fontWeight:700,color:C.text,fontFamily:"'Lora',serif"}}>{greeting}, Salma ğŸ‘‹</div>
        <button onClick={onDebrief} style={{padding:"9px 18px",borderRadius:10,border:"none",background:`linear-gradient(135deg,${C.accent},${C.purple})`,color:"#fff",fontSize:13,fontWeight:700,display:"flex",alignItems:"center",gap:7,boxShadow:"0 2px 10px #5b5bd622"}}>
          ğŸ“‹ Log Meeting
        </button>
      </div>
      <div className="stat-grid" style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(120px,1fr))",gap:9}}>
        <Stat label="Open Items" val={active.filter(i=>i.status!=="done").length} color={C.accent} sub={`${active.filter(i=>i.status==="done").length} done`}/>
        <Stat label="In Progress" val={inprog.length} color={C.blue}/>
        <Stat label="Blocked" val={blocked.length} color={C.red} click={blocked.length?()=>onNav("cards"):null}/>
        <Stat label="Overdue" val={overdue.length} color={C.orange} click={overdue.length?()=>onNav("cards"):null}/>
        <Stat label="Due in 3 Days" val={soon.length} color={C.yellow} click={soon.length?()=>onNav("cards"):null}/>
        <Stat label="Open Decisions" val={openDecisions.length} color={C.purple} click={()=>onNav("decisions")}/>
        <Stat label="Today Tasks" val={`${doneTodos}/${todayTodos.length}`} color={C.green} click={()=>onNav("todo")}/>
      </div>

      <div className="two-col" style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:13}}>
        {/* Alert card */}
        <div style={{background:C.card,border:`1px solid ${alertItems.length?"#fde68a":C.border}`,borderRadius:12,padding:"15px 17px",borderTop:`3px solid ${alertItems.length?C.orange:C.green}`}}>
          <div style={{fontSize:13,fontWeight:700,color:C.text,marginBottom:3}}>{alertItems.length?"âš ï¸ Needs Your Attention":"âœ… All Clear"}</div>
          <div style={{fontSize:11,color:C.t3,marginBottom:11}}>{alertItems.length?`${overdue.length} overdue Â· ${soon.length} due within 3 days`:"Nothing overdue or due soon!"}</div>
          {!alertItems.length&&<div style={{textAlign:"center",padding:"14px 0",fontSize:24}}>ğŸ‰</div>}
          {alertItems.map(item=>{
            const od=isOD(item.due),sec=getSec(item.section);
            return(
              <div key={item.id} onClick={()=>onEdit(item)} style={{display:"flex",alignItems:"center",gap:8,padding:"7px 9px",background:od?"#fef2f2":"#fffbeb",borderRadius:8,marginBottom:4,border:`1px solid ${od?"#fca5a8":"#fde68a"}`,cursor:"pointer"}}>
                <span style={{color:sec.color,flexShrink:0,fontSize:13}}>{sec.icon}</span>
                <div style={{flex:1,minWidth:0}}>
                  <div style={{fontSize:12,fontWeight:600,color:C.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{item.title}</div>
                  {item.workstream&&<div style={{fontSize:10,color:C.t3}}>ğŸ“ {item.workstream}</div>}
                </div>
                <div style={{flexShrink:0,textAlign:"right"}}>
                  <div style={{fontSize:10,fontWeight:700,color:od?C.red:C.yellow}}>{od?"OVERDUE":"SOON"}</div>
                  <div style={{fontSize:9,color:C.t3}}>{fmt(item.due)}</div>
                </div>
              </div>
            );
          })}
          {alertItems.length>0&&<button onClick={()=>onNav("cards")} style={{width:"100%",marginTop:7,padding:"5px",borderRadius:7,border:`1px solid ${C.border}`,background:"transparent",color:C.accent,fontSize:11,fontWeight:600}}>View all cards â†’</button>}
        </div>

        {/* Section breakdown */}
        <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:12,padding:"15px 17px"}}>
          <div style={{fontSize:13,fontWeight:700,color:C.text,marginBottom:11}}>Open by Section</div>
          {bySec.map(sec=>(
            <div key={sec.id} style={{marginBottom:9}}>
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:3}}>
                <span style={{fontSize:12,color:sec.color,fontWeight:600}}>{sec.icon} {sec.label}</span>
                <span style={{fontSize:11,color:C.t3}}>{sec.open} open</span>
              </div>
              <div style={{height:5,background:C.bg,borderRadius:3,overflow:"hidden"}}>
                <div style={{height:5,width:`${sec.total?Math.round(((sec.total-sec.open)/sec.total)*100):0}%`,background:sec.color,borderRadius:3,transition:"width 0.4s"}}/>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Today's tasks + open decisions */}
      <div className="two-col" style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:13}}>
        <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:12,padding:"15px 17px"}}>
          <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:9}}>
            <div style={{fontSize:13,fontWeight:700,color:C.text}}>âœ… Today's Tasks</div>
            <button onClick={()=>onNav("todo")} style={{fontSize:11,color:C.accent,background:"transparent",border:"none",fontWeight:600}}>Open â†’</button>
          </div>
          {!todayTodos.length&&<div style={{fontSize:12,color:C.t3}}>No tasks yet today</div>}
          {todayTodos.slice(0,5).map(t=>(
            <div key={t.id} style={{display:"flex",alignItems:"center",gap:7,padding:"5px 0",borderBottom:`1px solid ${C.border}`}}>
              <span style={{fontSize:13,color:t.done?C.green:C.t3}}>{t.done?"âœ“":"â—‹"}</span>
              <span style={{fontSize:12,color:t.done?C.t3:C.text,textDecoration:t.done?"line-through":"none",flex:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{t.text}</span>
            </div>
          ))}
          {todayTodos.length>5&&<div style={{fontSize:11,color:C.t3,marginTop:5}}>+{todayTodos.length-5} more</div>}
        </div>
        <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:12,padding:"15px 17px"}}>
          <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:9}}>
            <div style={{fontSize:13,fontWeight:700,color:C.text}}>âš– Open Decisions</div>
            <button onClick={()=>onNav("decisions")} style={{fontSize:11,color:C.accent,background:"transparent",border:"none",fontWeight:600}}>All â†’</button>
          </div>
          {!openDecisions.length&&<div style={{fontSize:12,color:C.t3}}>No open decisions</div>}
          {openDecisions.slice(0,4).map(d=>(
            <div key={d.id} style={{padding:"6px 0",borderBottom:`1px solid ${C.border}`,fontSize:12,color:C.text}}>
              <div style={{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{d.text}</div>
              <div style={{fontSize:10,color:C.t3,marginTop:1}}>{d.meeting} Â· {fmt(d.date)}</div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}

// â”€â”€ MEETING PREP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function MeetingPrep({items,onEdit,onStartNote,onDebrief}){
  const dow=new Date().getDay();
  const suggested=dow===1?TMPLS.opeleads:dow===5?TMPLS.ospops:TMPLS.sscz;
  const [sel,setSel]=useState(suggested.id);
  const tmpl=TMPLS[sel]||suggested;
  const sec=getSec(tmpl.section);
  const carries=items.filter(i=>i.section===tmpl.section&&i.status!=="done"&&i.status!=="archived"&&i.carryOver);
  const overdues=items.filter(i=>i.section===tmpl.section&&isOD(i.due)&&i.status!=="done");
  return(
    <div className="two-col" style={{display:"grid",gridTemplateColumns:"230px 1fr",gap:15,alignItems:"start"}}>
      <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:12,padding:"13px"}}>
        <div style={{fontSize:10,fontWeight:700,color:C.t2,letterSpacing:"0.07em",marginBottom:9}}>SELECT MEETING</div>
        <div style={{fontSize:11,color:C.t3,marginBottom:9}}>Today: {new Date().toLocaleDateString("en-US",{weekday:"long"})}</div>
        {ALL_TMPLS.map(t=>{
          const s=getSec(t.section),act=sel===t.id;
          return(
            <button key={t.id} onClick={()=>setSel(t.id)} style={{width:"100%",textAlign:"left",padding:"8px 10px",borderRadius:9,border:`1px solid ${act?s.color:C.border}`,background:act?s.color+"12":"transparent",marginBottom:4,display:"flex",alignItems:"center",gap:7}}>
              <span style={{color:s.color,fontSize:13}}>{s.icon}</span>
              <div>
                <div style={{fontSize:11,fontWeight:act?600:400,color:act?s.color:C.t2,lineHeight:1.3}}>{t.label}</div>
                {t.id===suggested.id&&<div style={{fontSize:9,color:s.color,marginTop:1}}>âœ¦ Suggested today</div>}
              </div>
            </button>
          );
        })}
      </div>
      <div style={{display:"flex",flexDirection:"column",gap:11}}>
        <div style={{background:sec.color+"0e",border:`1px solid ${sec.color}33`,borderRadius:12,padding:"14px 17px",display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:9}}>
          <div>
            <div style={{fontSize:15,fontWeight:700,color:C.text,fontFamily:"'Lora',serif"}}>{tmpl.title}</div>
            {tmpl.attendees&&<div style={{fontSize:11,color:C.t3,marginTop:2}}>ğŸ‘¥ {tmpl.attendees}</div>}
          </div>
          <div style={{display:"flex",gap:8\,flexWrap:"wrap"}}>
            <button onClick={()=>onStartNote(tmpl)} style={{padding:"8px 16px",borderRadius:9,border:`1px solid ${sec.color}`,background:"transparent",color:sec.color,fontSize:13,fontWeight:600,whiteSpace:"nowrap"}}>ğŸ“ Open Notes</button>
            <button onClick={()=>onDebrief(tmpl.id)} style={{padding:"8px 16px",borderRadius:9,border:"none",background:`linear-gradient(135deg,${C.accent},${C.purple})`,color:"#fff",fontSize:13,fontWeight:700,whiteSpace:"nowrap",boxShadow:"0 2px 8px #5b5bd633"}}>ğŸ“‹ Log Meeting â†’</button>
          </div>
        </div>
        {tmpl.agenda&&(
          <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:12,padding:"14px 17px"}}>
            <div style={{fontSize:10,fontWeight:700,color:C.t2,letterSpacing:"0.06em",marginBottom:9}}>ğŸ“‹ AGENDA / FOCUS</div>
            {tmpl.agenda.split("\n").filter(Boolean).map((line,i)=>(
              <div key={i} style={{fontSize:12,color:C.text,padding:"5px 0",borderBottom:`1px solid ${C.border}`,display:"flex",gap:7,lineHeight:1.5}}>
                <span style={{color:sec.color,fontWeight:700,flexShrink:0,minWidth:12}}>{line.match(/^\d+\./)&&<span>{i+1}.</span>}</span>
                <span style={{flex:1}}>{line.replace(/^\d+\.\s*/,"")}</span>
              </div>
            ))}
          </div>
        )}
        {carries.length>0&&(
          <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:12,padding:"14px 17px"}}>
            <div style={{fontSize:10,fontWeight:700,color:"#92400e",letterSpacing:"0.06em",marginBottom:9}}>â†» CARRY-OVERS ({carries.length})</div>
            {carries.map(item=>(
              <div key={item.id} onClick={()=>onEdit(item)} style={{display:"flex",alignItems:"center",gap:9,padding:"7px 9px",borderRadius:8,marginBottom:4,background:C.cream,cursor:"pointer",borderLeft:`3px solid ${getPri(item.priority).color}`}}>
                <span style={{flex:1,fontSize:12,fontWeight:500,color:C.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{item.title}</span>
                <Tag c={getStat(item.status).dot} label={getStat(item.status).label}/>
                {item.due&&<span style={{fontSize:10,color:isOD(item.due)?C.red:C.t3,flexShrink:0}}>{isOD(item.due)?"â° ":""}{fmt(item.due)}</span>}
              </div>
            ))}
          </div>
        )}
        {overdues.length>0&&(
          <div style={{background:"#fef2f2",border:"1px solid #fca5a8",borderRadius:12,padding:"13px 17px"}}>
            <div style={{fontSize:10,fontWeight:700,color:C.red,letterSpacing:"0.06em",marginBottom:7}}>â° OVERDUE â€” Raise in this meeting</div>
            {overdues.map(item=>(
              <div key={item.id} style={{fontSize:12,color:C.text,padding:"3px 0",display:"flex",gap:7}}>
                <span style={{color:C.red}}>!</span><span style={{flex:1}}>{item.title}</span>
                <span style={{fontSize:10,color:C.red,flexShrink:0}}>{fmt(item.due)}</span>
              </div>
            ))}
          </div>
        )}
        {!carries.length&&!overdues.length&&(
          <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:12,padding:"22px",textAlign:"center",color:C.t3}}>
            <div style={{fontSize:22,marginBottom:7}}>âœ¨</div>
            <div style={{fontSize:13,color:C.t2,fontWeight:500}}>All clear for this section!</div>
          </div>
        )}
      </div>
    </div>
  );
}

// â”€â”€ NOTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Notes({section,items,settings,onSave,onEdit,initTmpl,clearTmpl}){
  const sec0=section==="all"?"supervisor":section;
  const [sec,setSec]=useState(sec0);
  const S=getSec(sec);
  const dt=initTmpl||TMPLS[sec]||ALL_TMPLS[0];
  const [mode,setMode]=useState("template");
  const [title,setTitle]=useState(initTmpl?dt.title+" â€” "+fmt(today()):"");
  const [attendees,setAttendees]=useState(dt.attendees||"");
  const [ws,setWs]=useState("");
  const [startDate,setStartDate]=useState(today());
  const [due,setDue]=useState(today());
  const [pri,setPri]=useState("normal");
  const [jira,setJira]=useState("");
  const [fields,setFields]=useState({agenda:dt.agenda||"",decisions:"",actions:"",nextsteps:"",blockers:"",notes:""});
  const [blank,setBlank]=useState("");
  const [linked,setLinked]=useState([]);
  const [showLink,setShowLink]=useState(false);
  const [linkQ,setLinkQ]=useState("");
  const [saved,setSaved]=useState(false);
  const [aiLoading,setAiLoading]=useState(false);
  const [aiItems,setAiItems]=useState([]);
  const [showAI,setShowAI]=useState(false);

  const carries=useMemo(()=>items.filter(i=>i.section===sec&&i.status!=="done"&&i.status!=="archived"&&i.carryOver&&i.date>=lastWeek()),[items,sec]);
  const recent=useMemo(()=>items.filter(i=>i.section===sec&&i.status!=="archived").slice(0,4),[items,sec]);
  const linkable=useMemo(()=>items.filter(i=>!linked.includes(i.id)&&(!linkQ||i.title.toLowerCase().includes(linkQ.toLowerCase()))),[items,linked,linkQ]);
  const linkedObjs=linked.map(id=>items.find(i=>i.id===id)).filter(Boolean);

  useEffect(()=>{
    if(!initTmpl){
      const t=TMPLS[sec]||ALL_TMPLS[0];
      setTitle("");setAttendees(t.attendees||"");setWs("");
      setFields({agenda:t.agenda||"",decisions:"",actions:"",nextsteps:"",blockers:"",notes:""});
      setLinked([]);setBlank("");setStartDate(today());setDue(today());setAiItems([]);setShowAI(false);
    }
  },[sec]);

  function loadTmpl(t){
    setTitle(t.title+" â€” "+fmt(today()));
    setAttendees(t.attendees||"");
    setFields({agenda:t.agenda||"",decisions:"",actions:"",nextsteps:"",blockers:"",notes:""});
    setSec(t.section);setMode("template");
  }
  function saveCard(){
    if(!title.trim())return;
    onSave({id:Date.now(),section:sec,title,attendees,workstream:ws,...fields,blankNotes:blank,priority:pri,status:"pending",owner:"Salma",jira,startDate,due,carryOver:true,date:today(),type:"checkin",linkedItems:linked});
    setSaved(true);setTimeout(()=>setSaved(false),2000);
    const t=TMPLS[sec]||ALL_TMPLS[0];
    setTitle("");setAttendees(t.attendees||"");setWs("");setLinked([]);setBlank("");
    setFields({agenda:t.agenda||"",decisions:"",actions:"",nextsteps:"",blockers:"",notes:""});
    setAiItems([]);setShowAI(false);if(clearTmpl)clearTmpl();
  }
  async function runAI(){
    const txt=[fields.agenda,fields.decisions,fields.actions,fields.nextsteps,fields.blockers,fields.notes,blank].filter(Boolean).join("\n");
    if(!txt.trim()){alert("Add some notes first!");return;}
    setAiLoading(true);setShowAI(true);
    try{
      const res=await fetch("https://api.anthropic.com/v1/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"claude-sonnet-4-20250514",max_tokens:1000,messages:[{role:"user",content:`Extract all action items from these meeting notes. Return ONLY a JSON array, no markdown. Each item: {"title":"short task under 10 words","owner":"person (default Salma)","due":"YYYY-MM-DD or null","raw":"original line"}\n\n${txt}`}]})});
      const data=await res.json();
      const t=(data.content||[]).map(c=>c.text||"").join("").replace(/```json|```/g,"").trim();
      setAiItems(JSON.parse(t).map((a,i)=>({...a,id:`ai${i}`,sel:true})));
    }catch(e){console.error(e);setAiItems([]);}
    setAiLoading(false);
  }
  function convertAI(){
    aiItems.filter(a=>a.sel).forEach(a=>{
      onSave({id:Date.now()+Math.random(),section:sec,title:a.title,workstream:ws,agenda:"",decisions:"",actions:a.raw||"",nextsteps:"",blockers:"",notes:"",priority:"normal",status:"pending",owner:a.owner||"Salma",jira:"",startDate:today(),due:a.due||"",carryOver:true,date:today(),type:"checkin",linkedItems:[],attendees:""});
    });
    setAiItems([]);setShowAI(false);setSaved(true);setTimeout(()=>setSaved(false),2000);
  }

  return(
    <div className="notes-grid" style={{display:"grid",gridTemplateColumns:"1fr 280px",gap:15,alignItems:"start"}}>
      <Datalists/>
      <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:14,overflow:"hidden",display:"flex",flexDirection:"column"}}>
        {/* Header */}
        <div style={{padding:"11px 15px",borderBottom:`1px solid ${C.border}`,background:S.color+"08",display:"flex",alignItems:"center",gap:7,flexWrap:"wrap"}}>
          <span style={{fontSize:16,color:S.color}}>{S.icon}</span>
          <select value={sec} onChange={e=>setSec(e.target.value)} style={{background:"transparent",border:`1px solid ${S.color}44`,borderRadius:7,padding:"4px 8px",color:S.color,fontSize:12,fontWeight:600,outline:"none"}}>
            {SECTIONS.filter(s=>s.id!=="all").map(s=><option key={s.id} value={s.id}>{s.label}</option>)}
          </select>
          <div style={{flex:1}}/>
          {ALL_TMPLS.filter(t=>t.section===sec).map(t=>(
            <button key={t.id} onClick={()=>loadTmpl(t)} style={{padding:"3px 8px",borderRadius:6,border:`1px solid ${S.color}`,background:S.color+"15",color:S.color,fontSize:10,fontWeight:600,whiteSpace:"nowrap"}}>â†º {t.title.split(" â€” ")[0].slice(0,20)}</button>
          ))}
          <button onClick={()=>setMode("blank")} style={{padding:"4px 9px",borderRadius:7,border:`1px solid ${mode==="blank"?S.color:C.border}`,background:mode==="blank"?S.color+"18":"transparent",color:mode==="blank"?S.color:C.t2,fontSize:11,fontWeight:600}}>Blank</button>
          <button onClick={()=>setMode("template")} style={{padding:"4px 9px",borderRadius:7,border:`1px solid ${mode==="template"?S.color:C.border}`,background:mode==="template"?S.color+"18":"transparent",color:mode==="template"?S.color:C.t2,fontSize:11,fontWeight:600}}>Template</button>
        </div>

        <div style={{padding:"15px 17px",overflowY:"auto",flex:1,maxHeight:"calc(100vh - 250px)"}}>
          {carries.length>0&&(
            <div style={{background:"#fffbeb",border:"1px solid #fde68a",borderRadius:9,padding:"9px 12px",marginBottom:12}}>
              <div style={{fontSize:10,fontWeight:700,color:"#92400e",marginBottom:5}}>â†» CARRY-OVERS FROM LAST WEEK ({carries.length})</div>
              {carries.map(item=>(
                <div key={item.id} style={{display:"flex",alignItems:"center",gap:7,marginBottom:3,fontSize:12}}>
                  <span style={{color:getPri(item.priority).color}}>â—</span>
                  <span style={{flex:1,color:C.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{item.title}</span>
                  <Tag c={getStat(item.status).dot} label={getStat(item.status).label}/>
                  <button onClick={()=>setLinked(l=>l.includes(item.id)?l:[...l,item.id])} style={{fontSize:9,color:C.accent,background:C.accent+"15",border:`1px solid ${C.accent}33`,borderRadius:4,padding:"1px 5px",fontWeight:600}}>Link</button>
                </div>
              ))}
            </div>
          )}

          <input value={title} onChange={e=>setTitle(e.target.value)} placeholder="Title / topicâ€¦"
            style={{width:"100%",border:"none",borderBottom:`2px solid ${title?S.color:C.border}`,background:"transparent",fontSize:17,fontWeight:600,color:C.text,outline:"none",padding:"2px 0 9px",marginBottom:12,fontFamily:"'Lora',serif",transition:"border-color .2s"}}/>

          <div className="three-col" style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:8,marginBottom:12}}>
            {(sec==="meetings"||sec==="ope"||sec==="resc")&&<div style={{gridColumn:"1/-1"}}><Lbl>ATTENDEES</Lbl><input value={attendees} onChange={e=>setAttendees(e.target.value)} list="team" placeholder="Namesâ€¦" style={inp0}/></div>}
            <div><Lbl>WORK STREAM</Lbl><input value={ws} onChange={e=>setWs(e.target.value)} list="ws" placeholder="Selectâ€¦" style={inp0}/></div>
            <div><Lbl>START DATE</Lbl><input type="date" value={startDate} onChange={e=>setStartDate(e.target.value)} style={inp0}/></div>
            <div><Lbl>DUE DATE</Lbl><input type="date" value={due} onChange={e=>setDue(e.target.value)} style={inp0}/></div>
            <div><Lbl>PRIORITY</Lbl><select value={pri} onChange={e=>setPri(e.target.value)} style={inp0}>{PRIS.map(p=><option key={p.id} value={p.id}>{p.label}</option>)}</select></div>
            <div><Lbl>JIRA</Lbl><input value={jira} onChange={e=>setJira(e.target.value)} placeholder="TDPGM-â€¦" style={{...inp0,fontFamily:"'DM Mono',monospace"}}/></div>
          </div>

          {/* Link */}
          <div style={{marginBottom:12}}>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:4}}>
              <Lbl>ğŸ”— LINKED ITEMS</Lbl>
              <button onClick={()=>setShowLink(p=>!p)} style={{fontSize:10,color:C.accent,background:"transparent",border:`1px solid ${C.accent}`,borderRadius:5,padding:"2px 6px",fontWeight:600}}>+ Link</button>
            </div>
            {linkedObjs.length>0&&<div style={{display:"flex",flexWrap:"wrap",gap:4,marginBottom:6}}>{linkedObjs.map(li=><div key={li.id} style={{display:"flex",alignItems:"center",gap:3,background:C.cream,border:`1px solid ${C.border}`,borderRadius:5,padding:"2px 6px",fontSize:10}}><span style={{color:getSec(li.section).color}}>{getSec(li.section).icon}</span><span style={{maxWidth:120,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{li.title}</span><button onClick={()=>setLinked(l=>l.filter(id=>id!==li.id))} style={{background:"transparent",border:"none",color:C.t3,fontSize:9}}>âœ•</button></div>)}</div>}
            {showLink&&<div style={{background:C.cream,border:`1px solid ${C.border}`,borderRadius:8,padding:8}}><input value={linkQ} onChange={e=>setLinkQ(e.target.value)} placeholder="Search itemsâ€¦" style={{...inp0,marginBottom:6}}/><div style={{maxHeight:120,overflowY:"auto"}}>{linkable.slice(0,12).map(li=><div key={li.id} onClick={()=>{setLinked(l=>[...l,li.id]);setShowLink(false);setLinkQ("");}} style={{padding:"5px 7px",borderRadius:5,cursor:"pointer",display:"flex",alignItems:"center",gap:5,fontSize:11}} onMouseEnter={e=>e.currentTarget.style.background=C.card} onMouseLeave={e=>e.currentTarget.style.background="transparent"}><span style={{color:getSec(li.section).color}}>{getSec(li.section).icon}</span><span style={{flex:1}}>{li.title}</span><Tag c={getStat(li.status).dot} label={getStat(li.status).label}/></div>)}</div></div>}
          </div>

          {mode==="blank"&&<textarea value={blank} onChange={e=>setBlank(e.target.value)} placeholder={"Free-form notes...\n\nJot anything here â€” ideas, follow-ups, reminders.\nNo structure needed."} rows={13} style={{width:"100%",background:"transparent",border:"none",resize:"none",outline:"none",fontSize:13,color:C.text,lineHeight:1.9}}/>}
          {mode==="template"&&<div>{TFIELDS.map((f,i)=>(
            <div key={f.key} style={{borderBottom:i<TFIELDS.length-1?`1px solid ${C.border}`:"none",paddingBottom:11,marginBottom:11}}>
              <div style={{fontSize:10,fontWeight:700,color:S.color,letterSpacing:"0.06em",marginBottom:4}}>{f.icon} {f.label.toUpperCase()}</div>
              <textarea value={fields[f.key]} onChange={e=>setFields(v=>({...v,[f.key]:e.target.value}))} placeholder={f.ph} rows={f.key==="agenda"?4:2}
                style={{width:"100%",background:fields[f.key]?C.card:C.cream,border:`1px solid ${fields[f.key]?S.color+"44":C.border}`,borderRadius:8,padding:"7px 10px",resize:"vertical",outline:"none",fontSize:13,color:C.text,lineHeight:1.7,transition:"border-color .2s"}}/>
            </div>
          ))}</div>}

          {showAI&&(
            <div style={{marginTop:12,background:"#f0f0ff",border:`1px solid ${C.accent}44`,borderRadius:11,padding:"12px 14px"}}>
              <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8}}>
                <div style={{fontSize:12,fontWeight:700,color:C.accent}}>ğŸ¤– AI-Extracted Action Items</div>
                <button onClick={()=>setShowAI(false)} style={{background:"transparent",border:"none",color:C.t3,fontSize:12}}>âœ•</button>
              </div>
              {aiLoading&&<div style={{textAlign:"center",padding:"14px 0",color:C.t2,fontSize:12}}><span className="spin">â³</span> Analyzing notesâ€¦</div>}
              {!aiLoading&&!aiItems.length&&<div style={{fontSize:12,color:C.t3,textAlign:"center",padding:"7px 0"}}>No action items found</div>}
              {!aiLoading&&aiItems.map((a,i)=>(
                <div key={a.id} style={{display:"flex",gap:7,padding:"6px 8px",background:a.sel?C.card:"transparent",borderRadius:7,marginBottom:3,border:`1px solid ${a.sel?C.accent+"33":C.border}`}}>
                  <input type="checkbox" checked={a.sel} onChange={()=>setAiItems(items=>items.map((ai,ii)=>ii===i?{...ai,sel:!ai.sel}:ai))} style={{marginTop:3,accentColor:C.accent}}/>
                  <div style={{flex:1}}>
                    <div style={{fontSize:12,fontWeight:600,color:C.text}}>{a.title}</div>
                    {a.owner&&<span style={{fontSize:10,color:C.accent}}>ğŸ‘¤ {a.owner}</span>}
                    {a.due&&<span style={{fontSize:10,color:C.t3,marginLeft:7}}>ğŸ“… {fmt(a.due)}</span>}
                  </div>
                </div>
              ))}
              {!aiLoading&&aiItems.length>0&&<button onClick={convertAI} style={{width:"100%",marginTop:6,padding:"7px",borderRadius:7,border:"none",background:C.accent,color:"#fff",fontSize:12,fontWeight:600}}>âœ“ Convert {aiItems.filter(a=>a.sel).length} to Cards</button>}
            </div>
          )}
        </div>

        <div style={{padding:"9px 15px",borderTop:`1px solid ${C.border}`,display:"flex",gap:7,alignItems:"center",background:C.cream,flexShrink:0,flexWrap:"wrap"}}>
          <button onClick={runAI} disabled={aiLoading} style={{padding:"6px 12px",borderRadius:7,border:`1px solid ${C.accent}`,background:C.accent+"10",color:C.accent,fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:4}}>
            {aiLoading?<span className="spin">â³</span>:"ğŸ¤–"} Extract Tasks
          </button>
          <div style={{flex:1,fontSize:11,color:C.t3,minWidth:60}}>{!title.trim()?"Add a title to save":linked.length?`ğŸ”— ${linked.length} linked`:"Ready"}</div>
          <button onClick={saveCard} disabled={!title.trim()} style={{padding:"7px 18px",borderRadius:7,border:"none",background:saved?"#10b981":title.trim()?S.color:"#d4c9bb",color:"#fff",fontSize:13,fontWeight:600,transition:"background .3s"}}>
            {saved?"âœ“ Saved!":"Save as Card â†’"}
          </button>
        </div>
      </div>

      <div style={{display:"flex",flexDirection:"column",gap:11}}>
        <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:12,padding:"12px 13px"}}>
          <div style={{fontSize:10,fontWeight:700,color:C.t2,letterSpacing:"0.06em",marginBottom:8}}>RECENT IN SECTION</div>
          {!recent.length&&<div style={{fontSize:12,color:C.t3,textAlign:"center",padding:"9px 0"}}>No items yet</div>}
          {recent.map(item=>(
            <div key={item.id} onClick={()=>onEdit(item)} style={{background:C.bg,border:`1px solid ${C.border}`,borderRadius:8,padding:"7px 9px",marginBottom:4,cursor:"pointer",borderLeft:`3px solid ${getSec(item.section).color}`}}>
              <div style={{fontSize:11,fontWeight:600,color:C.text,marginBottom:3,lineHeight:1.3}}>{item.title}</div>
              <div style={{display:"flex",gap:3,flexWrap:"wrap"}}>
                <Tag c={getPri(item.priority).color} label={getPri(item.priority).label}/>
                <span style={{fontSize:9,color:C.t3,display:"flex",alignItems:"center",gap:2}}><span style={{width:5,height:5,borderRadius:"50%",background:getStat(item.status).dot,display:"inline-block"}}/>{getStat(item.status).label}</span>
              </div>
            </div>
          ))}
        </div>
        <div style={{background:C.accent+"0e",border:`1px solid ${C.accent}33`,borderRadius:12,padding:"11px 13px"}}>
          <div style={{fontSize:10,fontWeight:700,color:C.accent,letterSpacing:"0.06em",marginBottom:7}}>â†º ALL TEMPLATES</div>
          {ALL_TMPLS.map(t=><button key={t.id} onClick={()=>loadTmpl(t)} style={{width:"100%",textAlign:"left",padding:"5px 8px",borderRadius:7,border:`1px solid ${C.accent}22`,background:"transparent",color:C.t2,fontSize:11,marginBottom:3,display:"flex",alignItems:"center",gap:5}} onMouseEnter={e=>e.currentTarget.style.background=C.card} onMouseLeave={e=>e.currentTarget.style.background="transparent"}>
            <span style={{color:getSec(t.section).color,fontSize:11}}>{getSec(t.section).icon}</span>
            <span style={{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{t.label}</span>
          </button>)}
        </div>
      </div>
    </div>
  );
}

// â”€â”€ DECISION LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function DecisionLog({decisions,onAdd,onUpdate,onDelete}){
  const [showNew,setShowNew]=useState(false);
  const [nd,setNd]=useState({text:"",meeting:"",section:"supervisor",date:today(),owner:"Salma",status:"open"});
  function save(){if(!nd.text.trim())return;onAdd({id:Date.now(),...nd});setNd({text:"",meeting:"",section:"supervisor",date:today(),owner:"Salma",status:"open"});setShowNew(false);}
  const grouped=useMemo(()=>{
    const m={open:[],done:[]};
    decisions.forEach(d=>d.status==="open"?m.open.push(d):m.done.push(d));
    return m;
  },[decisions]);
  return(
    <div style={{maxWidth:800}}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:14}}>
        <div>
          <div style={{fontSize:14,fontWeight:700,color:C.text}}>âš– Decision Log</div>
          <div style={{fontSize:11,color:C.t3,marginTop:2}}>{grouped.open.length} open Â· {grouped.done.length} resolved</div>
        </div>
        <button onClick={()=>setShowNew(p=>!p)} style={{padding:"7px 14px",borderRadius:8,border:"none",background:C.accent,color:"#fff",fontSize:12,fontWeight:600}}>+ Add Decision</button>
      </div>

      {showNew&&(
        <div style={{background:C.card,border:`1px solid ${C.accent}44`,borderRadius:12,padding:"15px 17px",marginBottom:14}}>
          <div style={{fontSize:12,fontWeight:700,color:C.accent,marginBottom:11}}>New Decision</div>
          <div style={{display:"flex",flexDirection:"column",gap:9}}>
            <div><Lbl>DECISION</Lbl><textarea value={nd.text} onChange={e=>setNd(v=>({...v,text:e.target.value}))} placeholder="What was decided?" rows={2} style={{...inp0,resize:"vertical"}}/></div>
            <div className="three-col" style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:9}}>
              <div><Lbl>MEETING</Lbl><input value={nd.meeting} onChange={e=>setNd(v=>({...v,meeting:e.target.value}))} placeholder="Which meeting?" style={inp0}/></div>
              <div><Lbl>SECTION</Lbl><select value={nd.section} onChange={e=>setNd(v=>({...v,section:e.target.value}))} style={inp0}>{SECTIONS.filter(s=>s.id!=="all").map(s=><option key={s.id} value={s.id}>{s.label}</option>)}</select></div>
              <div><Lbl>DATE</Lbl><input type="date" value={nd.date} onChange={e=>setNd(v=>({...v,date:e.target.value}))} style={inp0}/></div>
            </div>
            <div style={{display:"flex",gap:9}}>
              <button onClick={()=>setShowNew(false)} style={{flex:1,padding:"8px",borderRadius:7,border:`1px solid ${C.border}`,background:"transparent",color:C.t2,fontSize:12}}>Cancel</button>
              <button onClick={save} style={{flex:2,padding:"8px",borderRadius:7,border:"none",background:C.accent,color:"#fff",fontSize:12,fontWeight:600}}>Save Decision</button>
            </div>
          </div>
        </div>
      )}

      {["open","done"].map(status=>(
        grouped[status].length>0&&(
          <div key={status} style={{marginBottom:18}}>
            <div style={{fontSize:10,fontWeight:700,color:C.t3,letterSpacing:"0.08em",padding:"3px 0 7px",borderBottom:`1px solid ${C.border}`,marginBottom:8}}>{status==="open"?"ğŸŸ¡ OPEN DECISIONS":"âœ… RESOLVED"}</div>
            {grouped[status].map(d=>{
              const sec=getSec(d.section);
              return(
                <div key={d.id} style={{background:C.card,border:`1px solid ${status==="open"?"#fde68a":C.border}`,borderRadius:10,padding:"12px 14px",marginBottom:7,borderLeft:`3px solid ${sec.color}`,display:"flex",gap:12,alignItems:"flex-start"}}>
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{fontSize:13,fontWeight:600,color:d.status==="done"?C.t2:C.text,textDecoration:d.status==="done"?"line-through":"none",lineHeight:1.4,marginBottom:4}}>{d.text}</div>
                    <div style={{display:"flex",gap:7,flexWrap:"wrap",alignItems:"center"}}>
                      <Tag c={sec.color} label={sec.tag||sec.label}/>
                      {d.meeting&&<span style={{fontSize:10,color:C.t3}}>ğŸ“ {d.meeting}</span>}
                      <span style={{fontSize:10,color:C.t3}}>ğŸ“… {fmt(d.date)}</span>
                      {d.owner&&<span style={{fontSize:10,color:C.t3}}>ğŸ‘¤ {d.owner}</span>}
                    </div>
                  </div>
                  <div style={{display:"flex",gap:5,flexShrink:0}}>
                    <button onClick={()=>onUpdate({...d,status:d.status==="open"?"done":"open"})} style={{padding:"4px 9px",borderRadius:6,border:`1px solid ${C.border}`,background:"transparent",color:d.status==="open"?C.green:C.orange,fontSize:11,fontWeight:600,whiteSpace:"nowrap"}}>{d.status==="open"?"âœ“ Resolve":"â†º Reopen"}</button>
                    <button onClick={()=>onDelete(d.id)} style={{background:"transparent",border:"none",color:C.t3,fontSize:11,padding:"0 3px"}}>âœ•</button>
                  </div>
                </div>
              );
            })}
          </div>
        )
      ))}
      {!decisions.length&&<div style={{textAlign:"center",color:C.t3,padding:"40px 0"}}><div style={{fontSize:32,marginBottom:8}}>âš–</div><div style={{fontSize:14,color:C.t2}}>No decisions logged yet</div><div style={{fontSize:12,marginTop:4}}>Add decisions from meetings to keep track of them</div></div>}
    </div>
  );
}

// â”€â”€ CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Cards({items,settings,onEdit,onDelete,onCycle,onArchive,all}){
  const [q,setQ]=useState(""),[fp,setFp]=useState("all"),[fs,setFs]=useState("all"),[showDone,setShowDone]=useState(false);
  const filtered=useMemo(()=>items.filter(i=>{
    if(!showDone&&i.status==="done")return false;
    if(fp!=="all"&&i.priority!==fp)return false;
    if(fs!=="all"&&i.status!==fs)return false;
    if(q){const lq=q.toLowerCase();return i.title.toLowerCase().includes(lq)||(i.agenda||"").toLowerCase().includes(lq)||(i.jira||"").toLowerCase().includes(lq)||(i.workstream||"").toLowerCase().includes(lq);}
    return true;
  }).sort((a,b)=>{const po={urgent:0,high:1,normal:2,low:3},so={blocked:0,pending:1,inprogress:2,done:3};if(po[a.priority]!==po[b.priority])return po[a.priority]-po[b.priority];return so[a.status]-so[b.status];}),[items,q,fp,fs,showDone]);
  const si={background:C.bg,border:`1px solid ${C.border}`,borderRadius:8,padding:"6px 10px",color:C.text,fontSize:12,outline:"none"};
  return(
    <div>
      <div style={{display:"flex",gap:8,marginBottom:13,flexWrap:"wrap"}}>
        <input value={q} onChange={e=>setQ(e.target.value)} placeholder="Search cardsâ€¦" style={{...si,flex:1,minWidth:130}}/>
        <select value={fp} onChange={e=>setFp(e.target.value)} style={si}><option value="all">All Priorities</option>{PRIS.map(p=><option key={p.id} value={p.id}>{p.label}</option>)}</select>
        <select value={fs} onChange={e=>setFs(e.target.value)} style={si}><option value="all">All Statuses</option>{STATS.filter(s=>s.id!=="archived").map(s=><option key={s.id} value={s.id}>{s.label}</option>)}</select>
        <button onClick={()=>setShowDone(d=>!d)} style={{padding:"6px 10px",borderRadius:8,border:`1px solid ${C.border}`,background:showDone?C.accent+"18":"transparent",color:showDone?C.accent:C.t2,fontSize:12}}>{showDone?"Hide Done":"Show Done"}</button>
      </div>
      {!filtered.length&&<div style={{textAlign:"center",color:C.t3,padding:"50px 0"}}><div style={{fontSize:36,marginBottom:10}}>â—ˆ</div><div>No items â€” start in Notes!</div></div>}
      <div className="card-grid" style={{display:"grid",gridTemplateColumns:"repeat(auto-fill,minmax(300px,1fr))",gap:11}}>
        {filtered.map(item=><ItemCard key={item.id} item={item} settings={settings} onEdit={onEdit} onDelete={onDelete} onCycle={onCycle} onArchive={onArchive} all={all}/>)}
      </div>
    </div>
  );
}

// â”€â”€ SEARCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Search({items,todos,decisions,settings,onEdit}){
  const [q,setQ]=useState("");
  const ref=useRef();
  useEffect(()=>ref.current?.focus(),[]);
  const results=useMemo(()=>{if(!q.trim())return[];const lq=q.toLowerCase();return items.filter(i=>[i.title,i.agenda,i.decisions,i.actions,i.nextsteps,i.blockers,i.notes,i.attendees,i.jira,i.workstream].some(f=>f&&f.toLowerCase().includes(lq)));},[items,q]);
  const todoR=useMemo(()=>q.trim()?todos.filter(t=>t.text.toLowerCase().includes(q.toLowerCase())):[],[todos,q]);
  const decR=useMemo(()=>q.trim()?decisions.filter(d=>d.text.toLowerCase().includes(q.toLowerCase())):[],[decisions,q]);
  return(
    <div style={{maxWidth:760}}>
      <div style={{background:C.card,border:`2px solid ${q?C.accent:C.border}`,borderRadius:12,padding:"9px 14px",display:"flex",alignItems:"center",gap:9,marginBottom:16,transition:"border-color .2s"}}>
        <span style={{fontSize:17,color:C.t3}}>ğŸ”</span>
        <input ref={ref} value={q} onChange={e=>setQ(e.target.value)} placeholder="Search titles, notes, decisions, Jira tickets, attendeesâ€¦" style={{flex:1,border:"none",background:"transparent",fontSize:14,color:C.text,outline:"none"}}/>
        {q&&<button onClick={()=>setQ("")} style={{background:"transparent",border:"none",color:C.t3,fontSize:13}}>âœ•</button>}
      </div>
      {!q&&<div style={{textAlign:"center",padding:"40px 0",color:C.t3}}><div style={{fontSize:34,marginBottom:9}}>ğŸ”</div><div style={{fontSize:14,fontWeight:600,color:C.t2,marginBottom:4}}>Search everything</div><div style={{fontSize:12}}>Notes, cards, decisions, tasks, Jira tickets, archived items</div></div>}
      {q&&!results.length&&!todoR.length&&!decR.length&&<div style={{textAlign:"center",padding:"40px 0",color:C.t3}}><div style={{fontSize:28,marginBottom:7}}>ğŸ¤·</div><div style={{fontSize:14,color:C.t2}}>No results for "<strong>{q}</strong>"</div></div>}
      {q&&(results.length>0||todoR.length>0||decR.length>0)&&(
        <div>
          <div style={{fontSize:12,color:C.t3,marginBottom:9,fontWeight:600}}>{results.length+todoR.length+decR.length} results for "<strong style={{color:C.text}}>{q}</strong>"</div>
          <div style={{display:"flex",flexDirection:"column",gap:8}}>
            {results.map(item=><ItemCard key={item.id} item={item} settings={settings} onEdit={onEdit} onDelete={null} onCycle={null} all={items} q={q}/>)}
            {decR.map(d=><div key={d.id} style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:10,padding:"11px 13px",display:"flex",alignItems:"center",gap:9}}><span style={{fontSize:14}}>âš–</span><div style={{flex:1}}><div style={{fontSize:13,fontWeight:600,color:C.text}}>{hl(d.text,q)}</div><div style={{fontSize:10,color:C.t3,marginTop:2}}>{d.meeting} Â· {fmt(d.date)}</div></div><Tag c={d.status==="open"?C.yellow:C.green} label={d.status}/></div>)}
            {todoR.map(t=><div key={t.id} style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:10,padding:"11px 13px",display:"flex",alignItems:"center",gap:9}}><span style={{color:t.done?C.green:C.t3,fontSize:12}}>{t.done?"âœ“":"â—‹"}</span><span style={{fontSize:12,color:t.done?C.t3:C.text,flex:1,textDecoration:t.done?"line-through":"none"}}>{hl(t.text,q)}</span><Tag c="#94a3b8" label="Task"/></div>)}
          </div>
        </div>
      )}
    </div>
  );
}

// â”€â”€ HISTORY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function History({items,onEdit}){
  const [fs,setFs]=useState("all"),[fm,setFm]=useState("all");
  const active=items.filter(i=>i.status!=="archived");
  const months=useMemo(()=>[...new Set(active.map(i=>i.date?.slice(0,7)).filter(Boolean))].sort().reverse(),[active]);
  const filtered=useMemo(()=>active.filter(i=>(fs==="all"||i.section===fs)&&(fm==="all"||i.date?.startsWith(fm))).sort((a,b)=>b.date?.localeCompare(a.date)),[active,fs,fm]);
  const byDate=useMemo(()=>{const m={};filtered.forEach(i=>{const d=i.date||"?";if(!m[d])m[d]=[];m[d].push(i);});return m;},[filtered]);
  const si={background:C.card,border:`1px solid ${C.border}`,borderRadius:8,padding:"6px 10px",color:C.text,fontSize:12,outline:"none"};
  return(
    <div style={{maxWidth:800}}>
      <div style={{display:"flex",gap:9,marginBottom:13,flexWrap:"wrap",alignItems:"center"}}>
        <div style={{fontSize:14,fontWeight:700,color:C.text,flex:1}}>ğŸ“š Notes History</div>
        <select value={fs} onChange={e=>setFs(e.target.value)} style={si}><option value="all">All Sections</option>{SECTIONS.filter(s=>s.id!=="all").map(s=><option key={s.id} value={s.id}>{s.label}</option>)}</select>
        <select value={fm} onChange={e=>setFm(e.target.value)} style={si}><option value="all">All Months</option>{months.map(m=><option key={m} value={m}>{new Date(m+"-01").toLocaleDateString("en-US",{month:"long",year:"numeric"})}</option>)}</select>
      </div>
      {!filtered.length&&<div style={{textAlign:"center",color:C.t3,padding:"40px 0"}}><div style={{fontSize:32,marginBottom:8}}>ğŸ“š</div><div style={{fontSize:14,color:C.t2}}>No notes yet</div></div>}
      {Object.entries(byDate).map(([date,dateItems])=>(
        <div key={date} style={{marginBottom:17}}>
          <div style={{fontSize:10,fontWeight:700,color:C.t3,letterSpacing:"0.08em",padding:"2px 0 6px",borderBottom:`1px solid ${C.border}`,marginBottom:7}}>{fmtFull(date)}</div>
          <div style={{display:"flex",flexDirection:"column",gap:6}}>
            {dateItems.map(item=>{
              const sec=getSec(item.section),pri=getPri(item.priority),sta=getStat(item.status);
              return(
                <div key={item.id} onClick={()=>onEdit(item)} style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:10,padding:"10px 13px",cursor:"pointer",borderLeft:`3px solid ${sec.color}`,display:"flex",gap:11,alignItems:"center"}}>
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{fontSize:13,fontWeight:600,color:C.text,marginBottom:2}}>{item.title}</div>
                    {item.workstream&&<div style={{fontSize:10,color:C.t3}}>ğŸ“ {item.workstream}</div>}
                    {item.decisions?.trim()&&<div style={{fontSize:11,color:C.t2,marginTop:2}}>âœ… {item.decisions.slice(0,70)}â€¦</div>}
                  </div>
                  <div style={{display:"flex",flexDirection:"column",gap:3,alignItems:"flex-end",flexShrink:0}}>
                    <Tag c={pri.color} label={pri.label}/>
                    <span style={{fontSize:9,color:C.t3,display:"flex",alignItems:"center",gap:2}}><span style={{width:5,height:5,borderRadius:"50%",background:sta.dot,display:"inline-block"}}/>{sta.label}</span>
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      ))}
    </div>
  );
}

// â”€â”€ ARCHIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Archive({items,onUnarchive,onDelete}){
  const archived=items.filter(i=>i.status==="archived").sort((a,b)=>b.date?.localeCompare(a.date));
  return(
    <div style={{maxWidth:800}}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:13}}>
        <div style={{fontSize:14,fontWeight:700,color:C.text}}>ğŸ—‚ Archive ({archived.length})</div>
        <div style={{fontSize:12,color:C.t3}}>Completed items. Still searchable.</div>
      </div>
      {!archived.length&&<div style={{textAlign:"center",color:C.t3,padding:"40px 0"}}><div style={{fontSize:32,marginBottom:8}}>ğŸ—‚</div><div style={{fontSize:14,color:C.t2}}>Archive is empty</div><div style={{fontSize:12,marginTop:4}}>Mark items Done â†’ click ğŸ—‚ to archive</div></div>}
      <div style={{display:"flex",flexDirection:"column",gap:6}}>
        {archived.map(item=>{const sec=getSec(item.section);return(
          <div key={item.id} style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:10,padding:"10px 13px",display:"flex",alignItems:"center",gap:9,opacity:.75}}>
            <span style={{color:sec.color,fontSize:13}}>{sec.icon}</span>
            <div style={{flex:1,minWidth:0}}>
              <div style={{fontSize:12,color:C.t2,fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{item.title}</div>
              <div style={{fontSize:10,color:C.t3,marginTop:1}}>{fmtFull(item.date)}</div>
            </div>
            <button onClick={()=>onUnarchive(item.id)} style={{padding:"3px 8px",borderRadius:6,border:`1px solid ${C.border}`,background:"transparent",color:C.t2,fontSize:11}}>Restore</button>
            <button onClick={()=>onDelete(item.id)} style={{background:"transparent",border:"none",color:C.red,fontSize:11}}>Delete</button>
          </div>
        );})}
      </div>
    </div>
  );
}

// â”€â”€ TODO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Todo({items,todos,onChange}){
  const [newTxt,setNewTxt]=useState("");
  const td=today(),tt=todos.filter(t=>t.date===td);
  const urgent=items.filter(i=>i.status!=="done"&&i.status!=="archived"&&["urgent","high"].includes(i.priority));
  function add(){if(!newTxt.trim())return;onChange([...todos,{id:Date.now(),text:newTxt.trim(),done:false,date:td}]);setNewTxt("");}
  return(
    <div className="two-col" style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:17,alignItems:"start"}}>
      <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:14,padding:"17px"}}>
        <div style={{fontSize:14,fontWeight:700,color:C.text,marginBottom:3}}>âœ… Today's Quick Tasks</div>
        <div style={{fontSize:11,color:C.t3,marginBottom:13}}>{new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric"})}</div>
        <div style={{display:"flex",gap:7,marginBottom:12}}>
          <input value={newTxt} onChange={e=>setNewTxt(e.target.value)} onKeyDown={e=>e.key==="Enter"&&add()} placeholder="Add taskâ€¦ (Enter)" style={{flex:1,...inp0}}/>
          <button onClick={add} style={{padding:"8px 12px",borderRadius:8,border:"none",background:C.accent,color:"#fff",fontSize:13,fontWeight:600}}>+</button>
        </div>
        {!tt.length&&<div style={{fontSize:12,color:C.t3,textAlign:"center",padding:"16px 0"}}>No tasks yet today</div>}
        {tt.map(t=>(
          <div key={t.id} style={{display:"flex",alignItems:"center",gap:8,padding:"7px 8px",borderRadius:7,marginBottom:3,background:t.done?C.cream:C.bg}}>
            <button onClick={()=>onChange(todos.map(x=>x.id===t.id?{...x,done:!x.done}:x))} style={{width:17,height:17,borderRadius:4,border:`2px solid ${t.done?C.green:C.border}`,background:t.done?C.green:"transparent",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center",fontSize:9,color:"#fff"}}>{t.done?"âœ“":""}</button>
            <span style={{flex:1,fontSize:12,color:t.done?C.t3:C.text,textDecoration:t.done?"line-through":"none"}}>{t.text}</span>
            <button onClick={()=>onChange(todos.filter(x=>x.id!==t.id))} style={{background:"transparent",border:"none",color:C.t3,fontSize:10}}>âœ•</button>
          </div>
        ))}
        {tt.length>0&&<div style={{marginTop:7,fontSize:11,color:C.t3,textAlign:"right"}}>{tt.filter(t=>t.done).length}/{tt.length} done</div>}
      </div>
      <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:14,padding:"17px"}}>
        <div style={{fontSize:14,fontWeight:700,color:C.text,marginBottom:3}}>ğŸ”¥ Needs Attention</div>
        <div style={{fontSize:11,color:C.t3,marginBottom:13}}>Urgent & High priority open items</div>
        {!urgent.length&&<div style={{fontSize:12,color:C.t3,textAlign:"center",padding:"16px 0"}}>Nothing urgent ğŸ‰</div>}
        {urgent.map(item=>{const p=getPri(item.priority),s=getSec(item.section);return(
          <div key={item.id} style={{padding:"8px 10px",borderRadius:8,marginBottom:4,background:C.bg,borderLeft:`3px solid ${p.color}`}}>
            <div style={{fontSize:12,fontWeight:600,color:C.text,marginBottom:2}}>{s.icon} {item.title}</div>
            {item.workstream&&<div style={{fontSize:10,color:C.t3}}>ğŸ“ {item.workstream}</div>}
            <div style={{display:"flex",gap:4,flexWrap:"wrap",marginTop:3}}>
              <Tag c={p.color} label={p.label}/>
              {item.due&&<span style={{fontSize:9,color:isOD(item.due)?C.red:C.t3,fontWeight:600}}>{isOD(item.due)?"â° ":""}{fmt(item.due)}</span>}
            </div>
          </div>
        );})}
      </div>
    </div>
  );
}

// â”€â”€ GANTT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Gantt({items,settings}){
  const [offset,setOffset]=useState(0);
  const COLS=28,withDates=items.filter(i=>i.due&&i.status!=="done"&&i.status!=="archived");
  const start=useMemo(()=>{const d=new Date();d.setDate(d.getDate()-d.getDay()+offset*7);d.setHours(0,0,0,0);return d;},[offset]);
  const days=useMemo(()=>Array.from({length:COLS},(_,i)=>{const d=new Date(start);d.setDate(d.getDate()+i);return d;}),[start]);
  const todayD=useMemo(()=>{const d=new Date();d.setHours(0,0,0,0);return d;},[]);
  const allImp=[...(settings.showDOE!==false?DOE_HOLIDAYS:[]),...(settings.importantDates||[])];
  function ci(ds){if(!ds)return-1;return Math.round((new Date(ds+"T00:00:00")-start)/86400000);}
  const impByCol=useMemo(()=>{const m={};allImp.forEach(d=>{const c=ci(d.date);if(c>=0&&c<COLS){if(!m[c])m[c]=[];m[c].push(d);}});return m;},[days,settings]);
  return(
    <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:14,padding:"17px",overflowX:"auto"}}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:8}}>
        <div style={{fontSize:14,fontWeight:700,color:C.text}}>ğŸ“… Gantt â€” 4 Week View</div>
        <div style={{display:"flex",gap:6}}>
          <button onClick={()=>setOffset(o=>o-1)} style={{padding:"5px 9px",borderRadius:7,border:`1px solid ${C.border}`,background:"transparent",color:C.t2,fontSize:12}}>â† Prev</button>
          <button onClick={()=>setOffset(0)} style={{padding:"5px 9px",borderRadius:7,border:`1px solid ${C.accent}`,background:C.accent+"15",color:C.accent,fontSize:12,fontWeight:600}}>Today</button>
          <button onClick={()=>setOffset(o=>o+1)} style={{padding:"5px 9px",borderRadius:7,border:`1px solid ${C.border}`,background:"transparent",color:C.t2,fontSize:12}}>Next â†’</button>
        </div>
      </div>
      <div style={{minWidth:680,overflowX:"auto"}}>
        <div style={{display:"grid",gridTemplateColumns:`180px repeat(${COLS},1fr)`,marginBottom:2,borderBottom:`1px solid ${C.border}`,paddingBottom:2}}>
          <div style={{fontSize:9,color:C.t3,fontWeight:700}}>ITEM</div>
          {days.map((d,i)=>{const isT=d.getTime()===todayD.getTime(),isMon=d.getDay()===1||i===0,imp=impByCol[i];return(
            <div key={i} title={imp?.map(x=>x.label).join(", ")} style={{fontSize:7,color:isT?C.accent:imp?C.green:isMon?C.t2:C.t3,fontWeight:isT?700:600,textAlign:"center",background:isT?C.accent+"12":imp?"#f0fdf4":"transparent",borderRadius:2,padding:"1px 0"}}>
              {isT||isMon?d.toLocaleDateString("en-US",{month:"short",day:"numeric"}):imp?"â˜…":""}
            </div>
          );})}
        </div>
        {!withDates.length&&<div style={{fontSize:12,color:C.t3,padding:"22px 0",textAlign:"center"}}>No items with dates yet</div>}
        {withDates.map(item=>{
          const sec=getSec(item.section),pri=getPri(item.priority),od=isOD(item.due),bar=od?C.red:pri.color;
          const si=ci(item.startDate||item.due),ei=ci(item.due);
          return(
            <div key={item.id} style={{display:"grid",gridTemplateColumns:`180px repeat(${COLS},1fr)`,marginBottom:2,alignItems:"center"}}>
              <div style={{fontSize:10,color:C.text,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingRight:6,display:"flex",gap:3,alignItems:"center"}}>
                <span style={{color:sec.color,flexShrink:0}}>{sec.icon}</span><span style={{overflow:"hidden",textOverflow:"ellipsis"}}>{item.title}</span>
              </div>
              {days.map((_,i)=>{
                const isT=days[i].getTime()===todayD.getTime(),inR=i>=Math.max(0,si)&&i<=Math.min(COLS-1,ei);
                const isS=i===si&&si>=0&&si<COLS,isE=i===ei&&ei>=0&&ei<COLS,isDot=si===ei&&isS;
                return(
                  <div key={i} style={{height:22,position:"relative",display:"flex",alignItems:"center"}}>
                    {isT&&<div style={{position:"absolute",top:0,bottom:0,left:"50%",width:1,background:C.accent+"55",zIndex:1}}/>}
                    {inR&&!isDot&&<div style={{position:"absolute",top:3,bottom:3,left:isS?"3px":"0",right:isE?"3px":"0",background:bar+"2e",borderRadius:`${isS?4:0}px ${isE?4:0}px ${isE?4:0}px ${isS?4:0}px`,border:`1px solid ${bar}44`,borderLeft:isS?`2px solid ${bar}`:"none",borderRight:isE?`2px solid ${bar}`:"none"}}/>}
                    {isDot&&<div style={{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%,-50%)",width:8,height:8,borderRadius:"50%",background:bar}}/>}
                  </div>
                );
              })}
            </div>
          );
        })}
      </div>
    </div>
  );
}

// â”€â”€ CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Cal({items,settings,onEdit}){
  const now=new Date();
  const [yr,setYr]=useState(now.getFullYear()),[mo,setMo]=useState(now.getMonth());
  const dIM=new Date(yr,mo+1,0).getDate(),fD=new Date(yr,mo,1).getDay(),td=today();
  const allImp=[...(settings.showDOE!==false?DOE_HOLIDAYS:[]),...(settings.importantDates||[])];
  const byDate=useMemo(()=>{
    const m={};
    items.filter(i=>i.due&&i.status!=="done"&&i.status!=="archived").forEach(item=>{const d=new Date(item.due+"T00:00:00");if(d.getFullYear()===yr&&d.getMonth()===mo){const k=d.getDate();if(!m[k])m[k]={items:[],imp:[]};m[k].items.push(item);}});
    allImp.forEach(imp=>{const d=new Date(imp.date+"T00:00:00");if(d.getFullYear()===yr&&d.getMonth()===mo){const k=d.getDate();if(!m[k])m[k]={items:[],imp:[]};m[k].imp.push(imp);}});
    // Calendar events from ICS
    (settings.calendarEvents||[]).forEach(ev=>{if(!ev.date)return;const d=new Date(ev.date+"T00:00:00");if(d.getFullYear()===yr&&d.getMonth()===mo){const k=d.getDate();if(!m[k])m[k]={items:[],imp:[]};m[k].imp.push({label:ev.summary,type:"calendar"});}});
    return m;
  },[items,yr,mo,settings]);
  const cells=useMemo(()=>{const a=[];for(let i=0;i<fD;i++)a.push(null);for(let i=1;i<=dIM;i++)a.push(i);return a;},[fD,dIM]);
  function prev(){if(mo===0){setMo(11);setYr(y=>y-1);}else setMo(m=>m-1);}
  function next(){if(mo===11){setMo(0);setYr(y=>y+1);}else setMo(m=>m+1);}
  return(
    <div style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:14,padding:"17px"}}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12,flexWrap:"wrap",gap:8}}>
        <div style={{fontSize:14,fontWeight:700,color:C.text}}>ğŸ—“ {new Date(yr,mo,1).toLocaleDateString("en-US",{month:"long",year:"numeric"})}</div>
        <div style={{display:"flex",gap:6}}>
          <button onClick={prev} style={{padding:"5px 9px",borderRadius:7,border:`1px solid ${C.border}`,background:"transparent",color:C.t2,fontSize:12}}>â† Prev</button>
          <button onClick={()=>{setYr(now.getFullYear());setMo(now.getMonth());}} style={{padding:"5px 9px",borderRadius:7,border:`1px solid ${C.accent}`,background:C.accent+"15",color:C.accent,fontSize:12,fontWeight:600}}>Today</button>
          <button onClick={next} style={{padding:"5px 9px",borderRadius:7,border:`1px solid ${C.border}`,background:"transparent",color:C.t2,fontSize:12}}>Next â†’</button>
        </div>
      </div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:1,marginBottom:3}}>
        {["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(d=><div key={d} style={{fontSize:10,color:C.t3,fontWeight:700,textAlign:"center",padding:"2px 0"}}>{d}</div>)}
      </div>
      <div style={{display:"grid",gridTemplateColumns:"repeat(7,1fr)",gap:3}}>
        {cells.map((day,i)=>{
          if(!day)return<div key={`e${i}`}/>;
          const ds=`${yr}-${String(mo+1).padStart(2,"0")}-${String(day).padStart(2,"0")}`,isT=ds===td,cell=byDate[day]||{items:[],imp:[]};
          const hasHol=cell.imp.some(x=>x.type==="holiday"||x.type==="break");
          return(
            <div key={day} style={{minHeight:72,background:isT?C.accent+"12":hasHol?"#fef9ee":cell.items.length?C.cream:C.bg,borderRadius:7,border:`1px solid ${isT?C.accent:hasHol?"#fde68a":C.border}`,padding:"4px 4px"}}>
              <div style={{fontSize:10,fontWeight:isT?700:400,color:isT?C.accent:C.t3,marginBottom:2}}>{day}</div>
              {cell.imp.slice(0,1).map((imp,ii)=><div key={ii} style={{fontSize:7,color:imp.type==="holiday"?C.red:imp.type==="break"?C.yellow:imp.type==="calendar"?C.blue:C.green,fontWeight:700,marginBottom:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>â˜… {imp.label}</div>)}
              {cell.items.slice(0,2).map(item=><div key={item.id} onClick={()=>onEdit(item)} title={item.title} style={{fontSize:8,color:C.text,background:getPri(item.priority).color+"20",border:`1px solid ${getPri(item.priority).color}44`,borderRadius:3,padding:"1px 3px",marginBottom:1,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",cursor:"pointer"}}>{getSec(item.section).icon} {item.title}</div>)}
              {cell.items.length>2&&<div style={{fontSize:7,color:C.t3}}>+{cell.items.length-2}</div>}
            </div>
          );
        })}
      </div>
    </div>
  );
}

// â”€â”€ MONITOR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Monitor({settings,onOpenSettings}){
  const Board=({title,color,icon,links,empty})=>(
    <div style={{background:C.card,border:`1px solid ${C.border}`,borderLeft:`3px solid ${color}`,borderRadius:12,padding:"13px 16px",marginBottom:10}}>
      <div style={{fontSize:13,fontWeight:700,color:C.text,marginBottom:8}}>{icon} {title}</div>
      {!links.length?<div style={{fontSize:12,color:C.t3}}>{empty}</div>:
        <div style={{display:"flex",flexWrap:"wrap",gap:6}}>{links.map((l,i)=><a key={i} href={l.url} target="_blank" rel="noopener noreferrer" style={{display:"inline-flex",alignItems:"center",gap:5,padding:"6px 12px",borderRadius:8,border:`1px solid ${color}44`,background:color+"0e",color,fontSize:12,fontWeight:600}}>{l.name} â†—</a>)}</div>}
    </div>
  );
  return(
    <div style={{maxWidth:660}}>
      <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:13}}>
        <div style={{fontSize:14,fontWeight:700,color:C.text}}>ğŸ”— External Tools</div>
        <button onClick={onOpenSettings} style={{padding:"6px 12px",borderRadius:8,border:`1px solid ${C.border}`,background:C.card,color:C.accent,fontSize:12,fontWeight:600}}>âš™ Configure</button>
      </div>
      <Board title="Jira Boards" color={C.blue} icon="â¬¡" links={(settings.jiraBoards||[]).map(b=>({name:b.name,url:`${b.base}/${b.prefix}`}))} empty="No Jira boards"/>
      <Board title="Zendesk" color={C.green} icon="â—ˆ" links={(settings.zendeskBoards||[]).map(b=>({name:b.name,url:`${b.base}/agent`}))} empty="No Zendesk boards"/>
      <Board title="Slack" color={C.yellow} icon="#" links={(settings.slackChannels||[]).map(c=>({name:c.name,url:c.workspace?`https://${c.workspace}.slack.com/app_redirect?channel=${c.channel}`:"#"}))} empty="No Slack channels"/>
      <Board title="Teams" color={C.purple} icon="ğŸ’¬" links={(settings.teamsChannels||[]).map(c=>({name:c.name,url:c.url}))} empty="No Teams channels"/>
    </div>
  );
}

// â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function Settings({settings,onSave,onClose,items,todos}){
  const [s,setS]=useState(JSON.parse(JSON.stringify(settings)));
  const [nd,setNd]=useState({date:"",label:"",type:"custom"});
  const [icsUrl,setIcsUrl]=useState("");
  const [icsLoading,setIcsLoading]=useState(false);
  const fileRef=useRef();
  const icsFileRef=useRef();

  const addJ=()=>setS(v=>({...v,jiraBoards:[...v.jiraBoards,{id:Date.now(),name:"",base:"https://doeord.atlassian.net/browse",prefix:""}]}));
  const delJ=id=>setS(v=>({...v,jiraBoards:v.jiraBoards.filter(b=>b.id!==id)}));
  const upJ=(id,k,val)=>setS(v=>({...v,jiraBoards:v.jiraBoards.map(b=>b.id===id?{...b,[k]:val}:b)}));
  function addDate(){if(!nd.date||!nd.label)return;setS(v=>({...v,importantDates:[...(v.importantDates||[]),{id:Date.now(),...nd}]}));setNd({date:"",label:"",type:"custom"});}
  function delDate(id){setS(v=>({...v,importantDates:(v.importantDates||[]).filter(d=>d.id!==id)}));}

  async function importICSUrl(){
    if(!icsUrl.trim())return;
    setIcsLoading(true);
    try{
      const res=await fetch(icsUrl);const text=await res.text();
      const events=parseICS(text);
      setS(v=>({...v,calendarEvents:[...(v.calendarEvents||[]),...events]}));
      alert(`âœ… Imported ${events.length} events from calendar!`);
    }catch(e){alert("Could not fetch calendar. Try uploading the .ics file instead.");}
    setIcsLoading(false);
  }
  function importICSFile(file){
    const r=new FileReader();
    r.onload=e=>{const events=parseICS(e.target.result);setS(v=>({...v,calendarEvents:[...(v.calendarEvents||[]),...events]}));alert(`âœ… Imported ${events.length} events!`);};
    r.readAsText(file);
  }
  function exportData(){const b=new Blob([JSON.stringify({items,todos,settings:s,exportedAt:new Date().toISOString()},null,2)],{type:"application/json"});const a=document.createElement("a");a.href=URL.createObjectURL(b);a.download=`daily-hub-${today()}.json`;a.click();}
  function importFile(file){const r=new FileReader();r.onload=e=>{try{const d=JSON.parse(e.target.result);if(d.items){lsSave("dh-items",d.items);lsSave("dh-todos",d.todos||[]);lsSave("dh-settings",d.settings||{});alert("âœ… Restored! Refresh the page.");}}catch{alert("Invalid file.");}};r.readAsText(file);}

  const si={background:C.cream,border:`1px solid ${C.border}`,borderRadius:7,padding:"7px 10px",color:C.text,fontSize:12,outline:"none"};
  const row={display:"flex",gap:6,alignItems:"center",marginBottom:5};
  const SH=({t,color,onAdd,lbl})=><div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:6,marginTop:2}}><div style={{fontSize:10,fontWeight:700,color,letterSpacing:"0.05em"}}>{t}</div>{onAdd&&<button onClick={onAdd} style={{padding:"2px 8px",borderRadius:5,border:`1px solid ${color}`,background:color+"15",color,fontSize:10,fontWeight:600}}>+ {lbl}</button>}</div>;

  return(
    <div style={{position:"fixed",inset:0,background:"#00000044",display:"flex",alignItems:"center",justifyContent:"center",zIndex:300,padding:20}} onClick={e=>{if(e.target===e.currentTarget)onClose();}}>
      <div className="modal-in" style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:16,padding:23,width:"100%",maxWidth:540,maxHeight:"92vh",overflowY:"auto"}}>
        <div style={{fontSize:15,fontWeight:700,color:C.text,marginBottom:3}}>âš™ Settings & Integrations</div>
        <div style={{fontSize:12,color:C.t3,marginBottom:15}}>Configure calendar, boards, channels, and dates.</div>

        {/* ICS Calendar Import */}
        <div style={{background:"#eff6ff",border:"1px solid #bfdbfe",borderRadius:10,padding:"13px 15px",marginBottom:15}}>
          <SH t="ğŸ“… OUTLOOK CALENDAR IMPORT (.ICS)" color={C.blue}/>
          <div style={{fontSize:11,color:C.t2,marginBottom:9,lineHeight:1.5}}>Import your Outlook calendar to show your meetings on the Calendar and Gantt views.</div>
          <div style={{fontSize:10,fontWeight:700,color:C.t2,marginBottom:5}}>Option 1 â€” Paste ICS URL from Outlook:</div>
          <div style={{display:"flex",gap:6,marginBottom:9}}>
            <input value={icsUrl} onChange={e=>setIcsUrl(e.target.value)} placeholder="https://outlook.office365.com/owa/calendar/â€¦" style={{...si,flex:1,width:"100%"}}/>
            <button onClick={importICSUrl} disabled={icsLoading||!icsUrl.trim()} style={{padding:"7px 11px",borderRadius:7,border:"none",background:C.blue,color:"#fff",fontSize:12,fontWeight:600,whiteSpace:"nowrap"}}>{icsLoading?"â€¦":"Import"}</button>
          </div>
          <div style={{fontSize:10,fontWeight:700,color:C.t2,marginBottom:5}}>Option 2 â€” Upload .ics file:</div>
          <button onClick={()=>icsFileRef.current.click()} style={{width:"100%",padding:"8px",borderRadius:7,border:`2px dashed ${C.blue}44`,background:"transparent",color:C.blue,fontSize:12,fontWeight:600}}>ğŸ“ Upload .ics file</button>
          <input ref={icsFileRef} type="file" accept=".ics" style={{display:"none"}} onChange={e=>{if(e.target.files[0])importICSFile(e.target.files[0]);}}/>
          {(s.calendarEvents||[]).length>0&&<div style={{fontSize:11,color:C.blue,marginTop:8,display:"flex",alignItems:"center",justifyContent:"space-between"}}>âœ… {s.calendarEvents.length} calendar events imported<button onClick={()=>setS(v=>({...v,calendarEvents:[]}))} style={{background:"transparent",border:"none",color:C.red,fontSize:11}}>Clear</button></div>}
          <div style={{fontSize:10,color:C.t3,marginTop:8,lineHeight:1.5}}><strong>How to get your ICS URL from Outlook:</strong><br/>1. Go to outlook.office.com â†’ Settings â†’ View all settings<br/>2. Calendar â†’ Shared calendars â†’ Publish a calendar<br/>3. Set to "Can view all details" â†’ copy the ICS link</div>
        </div>

        {/* Important dates */}
        <div style={{background:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:10,padding:"13px 15px",marginBottom:15}}>
          <SH t="ğŸ“Œ IMPORTANT DATES" color={C.green}/>
          <div style={{display:"flex",alignItems:"center",gap:6,marginBottom:8}}>
            <input type="checkbox" checked={s.showDOE!==false} onChange={e=>setS(v=>({...v,showDOE:e.target.checked}))} style={{accentColor:C.green}}/>
            <span style={{fontSize:12,color:C.t2}}>Show DOE/NYC holidays & school breaks</span>
          </div>
          <div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr auto",gap:5,marginBottom:6}}>
            <input type="date" value={nd.date} onChange={e=>setNd(d=>({...d,date:e.target.value}))} style={{...si,width:"100%"}}/>
            <input value={nd.label} onChange={e=>setNd(d=>({...d,label:e.target.value}))} placeholder="Label" style={{...si,width:"100%"}}/>
            <select value={nd.type} onChange={e=>setNd(d=>({...d,type:e.target.value}))} style={{...si,width:"100%"}}>
              <option value="pto">PTO</option><option value="qc">QC</option><option value="release">Release</option><option value="deadline">Deadline</option><option value="custom">Custom</option>
            </select>
            <button onClick={addDate} style={{padding:"7px 10px",borderRadius:7,border:"none",background:C.green,color:"#fff",fontSize:12,fontWeight:600}}>+</button>
          </div>
          {(s.importantDates||[]).map(d=><div key={d.id} style={{display:"flex",alignItems:"center",gap:7,padding:"3px 0",borderBottom:"1px solid #d1fae5",fontSize:11}}><span style={{color:C.green,fontWeight:600}}>{fmt(d.date)}</span><span style={{flex:1}}>{d.label}</span><Tag c={C.green} label={d.type}/><button onClick={()=>delDate(d.id)} style={{background:"transparent",border:"none",color:C.red,fontSize:11}}>âœ•</button></div>)}
        </div>

        <SH t="ğŸ”µ JIRA BOARDS" color={C.blue} onAdd={addJ} lbl="Add"/>
        {s.jiraBoards.map(b=><div key={b.id} style={row}><input value={b.name} onChange={e=>upJ(b.id,"name",e.target.value)} placeholder="Name" style={{...si,flex:"0 0 70px"}}/><input value={b.prefix} onChange={e=>upJ(b.id,"prefix",e.target.value)} placeholder="Prefix" style={{...si,flex:"0 0 75px",fontFamily:"'DM Mono',monospace"}}/><input value={b.base} onChange={e=>upJ(b.id,"base",e.target.value)} placeholder="Base URL" style={{...si,flex:1}}/><button onClick={()=>delJ(b.id)} style={{background:"transparent",border:"none",color:C.red,fontSize:13}}>âœ•</button></div>)}

        <div style={{borderTop:`1px solid ${C.border}`,marginTop:13,paddingTop:13,marginBottom:13}}>
          <div style={{fontSize:10,fontWeight:700,color:C.t2,marginBottom:7}}>ğŸ’¾ BACKUP & RESTORE</div>
          <div style={{display:"flex",gap:7}}>
            <button onClick={exportData} style={{flex:1,padding:"8px",borderRadius:8,border:`1px solid ${C.border}`,background:C.cream,color:C.blue,fontSize:12,fontWeight:600}}>â¬‡ Export</button>
            <button onClick={()=>fileRef.current.click()} style={{flex:1,padding:"8px",borderRadius:8,border:`1px solid ${C.border}`,background:C.cream,color:C.green,fontSize:12,fontWeight:600}}>â¬† Import</button>
            <input ref={fileRef} type="file" accept=".json" style={{display:"none"}} onChange={e=>{if(e.target.files[0])importFile(e.target.files[0]);}}/>
          </div>
        </div>
        <div style={{display:"flex",gap:8}}>
          <button onClick={onClose} style={{flex:1,padding:"10px",borderRadius:8,border:`1px solid ${C.border}`,background:"transparent",color:C.t2,fontSize:13}}>Cancel</button>
          <button onClick={()=>{onSave(s);onClose();}} style={{flex:2,padding:"10px",borderRadius:8,border:"none",background:C.accent,color:"#fff",fontSize:13,fontWeight:600}}>Save Settings</button>
        </div>
      </div>
    </div>
  );
}

// â”€â”€ EDIT MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function EditModal({item,onSave,onClose,all}){
  const [e,setE]=useState({...item});
  const [lq,setLq]=useState(""),[showL,setShowL]=useState(false);
  const linkedObjs=(e.linkedItems||[]).map(id=>all.find(i=>i.id===id)).filter(Boolean);
  const linkable=all.filter(i=>i.id!==e.id&&!(e.linkedItems||[]).includes(i.id)&&(!lq||i.title.toLowerCase().includes(lq.toLowerCase())));
  return(
    <div style={{position:"fixed",inset:0,background:"#00000044",display:"flex",alignItems:"center",justifyContent:"center",zIndex:200,padding:20}} onClick={ev=>{if(ev.target===ev.currentTarget)onClose();}}>
      <div className="modal-in" style={{background:C.card,border:`1px solid ${C.border}`,borderRadius:16,padding:22,width:"100%",maxWidth:540,maxHeight:"92vh",overflowY:"auto"}}>
        <Datalists/>
        <div style={{fontSize:15,fontWeight:700,color:C.text,marginBottom:13}}>Edit Item</div>
        <div style={{display:"flex",flexDirection:"column",gap:8}}>
          <div><Lbl>TITLE</Lbl><input value={e.title||""} onChange={ev=>setE(i=>({...i,title:ev.target.value}))} style={inp0}/></div>
          {e.attendees!==undefined&&<div><Lbl>ATTENDEES</Lbl><input value={e.attendees||""} onChange={ev=>setE(i=>({...i,attendees:ev.target.value}))} list="team" style={inp0}/></div>}
          <div><Lbl>WORK STREAM</Lbl><input value={e.workstream||""} onChange={ev=>setE(i=>({...i,workstream:ev.target.value}))} list="ws" style={inp0}/></div>
          <div className="two-col" style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
            <div><Lbl>SECTION</Lbl><select value={e.section||""} onChange={ev=>setE(i=>({...i,section:ev.target.value}))} style={inp0}>{SECTIONS.filter(s=>s.id!=="all").map(s=><option key={s.id} value={s.id}>{s.label}</option>)}</select></div>
            <div><Lbl>PRIORITY</Lbl><select value={e.priority||""} onChange={ev=>setE(i=>({...i,priority:ev.target.value}))} style={inp0}>{PRIS.map(p=><option key={p.id} value={p.id}>{p.label}</option>)}</select></div>
            <div><Lbl>STATUS</Lbl><select value={e.status||""} onChange={ev=>setE(i=>({...i,status:ev.target.value}))} style={inp0}>{STATS.map(s=><option key={s.id} value={s.id}>{s.label}</option>)}</select></div>
            <div><Lbl>OWNER</Lbl><input value={e.owner||""} onChange={ev=>setE(i=>({...i,owner:ev.target.value}))} list="team" style={inp0}/></div>
            <div><Lbl>START DATE</Lbl><input type="date" value={e.startDate||""} onChange={ev=>setE(i=>({...i,startDate:ev.target.value}))} style={inp0}/></div>
            <div><Lbl>DUE DATE</Lbl><input type="date" value={e.due||""} onChange={ev=>setE(i=>({...i,due:ev.target.value}))} style={inp0}/></div>
          </div>
          <div><Lbl>JIRA</Lbl><input value={e.jira||""} onChange={ev=>setE(i=>({...i,jira:ev.target.value}))} style={{...inp0,fontFamily:"'DM Mono',monospace"}}/></div>
          <div style={{background:C.cream,border:`1px solid ${C.border}`,borderRadius:8,padding:"9px"}}>
            <div style={{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:5}}><Lbl>ğŸ”— LINKED ITEMS</Lbl><button onClick={()=>setShowL(p=>!p)} style={{fontSize:10,color:C.accent,background:"transparent",border:`1px solid ${C.accent}`,borderRadius:5,padding:"2px 6px",fontWeight:600}}>+ Link</button></div>
            {linkedObjs.length>0&&<div style={{display:"flex",flexWrap:"wrap",gap:4,marginBottom:5}}>{linkedObjs.map(li=><div key={li.id} style={{display:"flex",alignItems:"center",gap:3,background:C.card,border:`1px solid ${C.border}`,borderRadius:5,padding:"2px 6px",fontSize:10}}><span style={{color:getSec(li.section).color}}>{getSec(li.section).icon}</span><span style={{maxWidth:120,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{li.title}</span><button onClick={()=>setE(i=>({...i,linkedItems:(i.linkedItems||[]).filter(id=>id!==li.id)}))} style={{background:"transparent",border:"none",color:C.t3,fontSize:9}}>âœ•</button></div>)}</div>}
            {showL&&<><input value={lq} onChange={ev=>setLq(ev.target.value)} placeholder="Searchâ€¦" style={{...inp0,marginBottom:5}}/><div style={{maxHeight:100,overflowY:"auto"}}>{linkable.slice(0,10).map(li=><div key={li.id} onClick={()=>{setE(i=>({...i,linkedItems:[...(i.linkedItems||[]),li.id]}));setShowL(false);setLq("");}} style={{padding:"5px 6px",borderRadius:5,cursor:"pointer",display:"flex",alignItems:"center",gap:5,fontSize:11}} onMouseEnter={e=>e.currentTarget.style.background=C.bg} onMouseLeave={e=>e.currentTarget.style.background="transparent"}><span style={{color:getSec(li.section).color}}>{getSec(li.section).icon}</span><span style={{flex:1}}>{li.title}</span><Tag c={getStat(li.status).dot} label={getStat(li.status).label}/></div>)}</div></>}
          </div>
          {TFIELDS.map(f=><div key={f.key}><Lbl>{f.icon} {f.label.toUpperCase()}</Lbl><textarea value={e[f.key]||""} onChange={ev=>setE(i=>({...i,[f.key]:ev.target.value}))} rows={2} placeholder={f.ph} style={{...inp0,resize:"vertical"}}/></div>)}
          <div style={{display:"flex",alignItems:"center",gap:7}}>
            <div onClick={()=>setE(i=>({...i,carryOver:!i.carryOver}))} style={{width:28,height:15,borderRadius:8,background:e.carryOver?C.accent:C.border,position:"relative",cursor:"pointer",flexShrink:0}}>
              <div style={{width:9,height:9,borderRadius:"50%",background:"#fff",position:"absolute",top:3,left:e.carryOver?16:2,transition:"left .2s"}}/>
            </div>
            <span style={{fontSize:12,color:C.t2}}>Carry over until done</span>
          </div>
        </div>
        <div style={{display:"flex",gap:8,marginTop:15}}>
          <button onClick={onClose} style={{flex:1,padding:"9px",borderRadius:8,border:`1px solid ${C.border}`,background:"transparent",color:C.t2,fontSize:13}}>Cancel</button>
          <button onClick={()=>{if(e.title?.trim())onSave(e);}} style={{flex:2,padding:"9px",borderRadius:8,border:"none",background:C.accent,color:"#fff",fontSize:13,fontWeight:600}}>Save Changes</button>
        </div>
      </div>
    </div>
  );
}

// â”€â”€ APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function App(){
  const [items,       setItemsRaw]     = useState(()=>lsGet("dh-items",SAMPLE));
  const [todos,       setTodosRaw]     = useState(()=>lsGet("dh-todos",SAMPLE_TODOS));
  const [decisions,   setDecisionsRaw] = useState(()=>lsGet("dh-decisions",SAMPLE_DECISIONS));
  const [settings,    setSettingsRaw]  = useState(()=>lsGet("dh-settings",DEF_SETTINGS));
  const [view,        setView]         = useState("dashboard");
  const [section,     setSection]      = useState("all");
  const [editItem,    setEditItem]     = useState(null);
  const [showSettings,setShowSettings] = useState(false);
  const [showCapture, setShowCapture]  = useState(false);
  const [showDebrief, setShowDebrief]  = useState(false);
  const [debriefTmpl, setDebriefTmpl]  = useState(null);
  const [showDebrief, setShowDebrief]  = useState(false);
  const [debriefTmpl, setDebriefTmpl]  = useState(null);
  const [sidebar,     setSidebar]      = useState(true);
  const [flash,       setFlash]        = useState(false);
  const [prepTmpl,    setPrepTmpl]     = useState(null);

  function setItems(v){setItemsRaw(v);lsSave("dh-items",v);pulse();}
  function setTodos(v){setTodosRaw(v);lsSave("dh-todos",v);pulse();}
  function setDecisions(v){setDecisionsRaw(v);lsSave("dh-decisions",v);pulse();}
  function setSettings(v){setSettingsRaw(v);lsSave("dh-settings",v);pulse();}
  function pulse(){setFlash(true);setTimeout(()=>setFlash(false),1500);}

  // Keyboard shortcut: Cmd/Ctrl + K = quick capture
  useEffect(()=>{
    function onKey(e){if((e.metaKey||e.ctrlKey)&&e.key==="k"){e.preventDefault();setShowCapture(true);}}
    window.addEventListener("keydown",onKey);return()=>window.removeEventListener("keydown",onKey);
  },[]);

  const active=useMemo(()=>items.filter(i=>i.status!=="archived"),[items]);
  const sectionItems=useMemo(()=>section==="all"?active:active.filter(i=>i.section===section),[active,section]);

  function openEdit(item){setEditItem(item);}
  function saveEdit(e){setItems(items.map(i=>i.id===e.id?e:i));setEditItem(null);}
  function deleteItem(id){setItems(items.filter(i=>i.id!==id));}
  function archiveItem(id){setItems(items.map(i=>i.id===id?{...i,status:"archived"}:i));}
  function unarchiveItem(id){setItems(items.map(i=>i.id===id?{...i,status:"done"}:i));}
  function cycleStatus(item){const idx=STATS.findIndex(s=>s.id===item.status);setItems(items.map(i=>i.id===item.id?{...i,status:STATS[(idx+1)%4].id}:i));}
  function saveNote(item){setItems([item,...items]);}
  function startNoteFromPrep(tmpl){setPrepTmpl(tmpl);setView("notes");}
  function navTo(v){setView(v);}

  function openDebrief(tmplId){setDebriefTmpl(tmplId||null);setShowDebrief(true);}
  function handleDebriefSave(out,updateCardIds){
    const newItems=[...out.items,...items];
    setItems(updateCardIds.length?newItems.map(i=>updateCardIds.includes(i.id)?{...i,status:"inprogress"}:i):newItems);
    if(out.decisions.length)setDecisions(prev=>[...out.decisions,...prev]);
  }
  function handleQuickSave(type,data){
    if(type==="todo")setTodos([data,...todos]);
    else if(type==="item")setItems([data,...items]);
    else if(type==="decision")setDecisions([data,...decisions]);
  }

  // Sidebar badges
  const secBadge=useMemo(()=>{
    const m={};
    SECTIONS.forEach(s=>{
      const it=s.id==="all"?active:active.filter(i=>i.section===s.id);
      m[s.id]={open:it.filter(i=>i.status!=="done").length,urgent:it.filter(i=>i.status!=="done"&&["urgent","high"].includes(i.priority)).length,od:it.filter(i=>i.status!=="done"&&isOD(i.due)).length};
    });
    return m;
  },[active]);

  const totalUrgent=secBadge["all"]?.od+secBadge["all"]?.urgent||0;
  useEffect(()=>{document.title=totalUrgent>0?`(${totalUrgent}) Daily Hub`:"Daily Hub";},[totalUrgent]);

  const V=VIEWS.find(v=>v.id===view);
  const SEC=getSec(section);

  return(
    <div style={{display:"flex",height:"100vh",background:C.bg,overflow:"hidden",position:"relative"}}>
      {flash&&<div style={{position:"fixed",bottom:16,right:16,background:"#ecfdf5",border:"1px solid #6ee7b7",borderRadius:8,padding:"5px 12px",fontSize:11,color:"#059669",fontWeight:600,zIndex:999,pointerEvents:"none",boxShadow:"0 2px 8px #0001"}}>ğŸ’¾ Saved</div>}

      {/* â”€â”€ FLOATING QUICK CAPTURE BUTTON â”€â”€ */}
      <button onClick={()=>setShowCapture(true)} title="Quick Capture (âŒ˜K)"
        style={{position:"fixed",bottom:22,right:22,width:48,height:48,borderRadius:"50%",border:"none",background:`linear-gradient(135deg,${C.accent},${C.purple})`,color:"#fff",fontSize:22,boxShadow:"0 4px 16px #0003",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",transition:"transform .15s"}}
        onMouseEnter={e=>e.currentTarget.style.transform="scale(1.08)"}
        onMouseLeave={e=>e.currentTarget.style.transform="scale(1)"}>
        +
      </button>

      {/* â”€â”€ SIDEBAR â”€â”€ */}
      <div className="sidebar" style={{width:sidebar?248:52,background:C.sb,borderRight:`1px solid ${C.border}`,display:"flex",flexDirection:"column",transition:"width .2s",flexShrink:0,overflow:"hidden"}}>
        <div style={{padding:"14px 12px 11px",borderBottom:`1px solid ${C.border}`,display:"flex",alignItems:"center",gap:9}}>
          <div style={{width:28,height:28,background:`linear-gradient(135deg,${C.accent},${C.purple})`,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:12,flexShrink:0}}>â¬¡</div>
          <div className="sb-label">
            <div style={{fontSize:13,fontWeight:700,color:C.text,fontFamily:"'Lora',serif"}}>Daily Hub</div>
            <div style={{fontSize:9,color:C.t3}}>Salma's Check-In</div>
          </div>
        </div>

        <div style={{padding:"9px 6px 3px",overflowY:"auto",flex:1}}>
          {sidebar&&<div style={{fontSize:9,color:C.t3,fontWeight:700,letterSpacing:"0.08em",padding:"3px 8px 5px"}}>SECTIONS</div>}
          {SECTIONS.map(sec=>{
            const act=section===sec.id,b=secBadge[sec.id]||{};
            return(
              <button key={sec.id} onClick={()=>setSection(sec.id)} style={{width:"100%",display:"flex",alignItems:"center",gap:8,padding:"7px 8px",borderRadius:8,border:"none",background:act?sec.color+"18":"transparent",color:act?sec.color:C.t2,marginBottom:1,transition:"all .15s"}}>
                <span style={{fontSize:13,flexShrink:0}}>{sec.icon}</span>
                <span className="sb-label" style={{fontSize:12,fontWeight:act?600:400,flex:1,textAlign:"left",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{sec.label}</span>
                {sidebar&&<div style={{display:"flex",gap:2,flexShrink:0}}>
                  {b.od>0&&<span style={{background:"#fee2e2",color:C.red,fontSize:8,fontWeight:700,padding:"1px 4px",borderRadius:9}}>â°{b.od}</span>}
                  {b.urgent>0&&<span style={{background:"#fff7ed",color:C.orange,fontSize:8,fontWeight:700,padding:"1px 4px",borderRadius:9}}>!{b.urgent}</span>}
                  {b.open>0&&<span style={{background:sec.color+"18",color:sec.color,fontSize:8,fontWeight:600,padding:"1px 4px",borderRadius:9}}>{b.open}</span>}
                </div>}
              </button>
            );
          })}

          {sidebar&&<div style={{fontSize:9,color:C.t3,fontWeight:700,letterSpacing:"0.08em",padding:"9px 8px 5px"}}>VIEWS</div>}
          {!sidebar&&<div style={{borderTop:`1px solid ${C.border}44`,marginTop:4,paddingTop:4}}/>}
          {VIEWS.map(v=>{
            const act=view===v.id;
            return(
              <button key={v.id} onClick={()=>setView(v.id)} style={{width:"100%",display:"flex",alignItems:"center",gap:8,padding:"6px 8px",borderRadius:8,border:"none",background:act?C.accent+"18":"transparent",color:act?C.accent:C.t2,marginBottom:1,transition:"all .15s"}}>
                <span style={{fontSize:12,flexShrink:0}}>{v.icon}</span>
                <span className="sb-label" style={{fontSize:12,fontWeight:act?600:400,whiteSpace:"nowrap"}}>{v.label}</span>
              </button>
            );
          })}
        </div>

        <div style={{padding:"6px",borderTop:`1px solid ${C.border}`}}>
          <button onClick={()=>setShowSettings(true)} style={{width:"100%",padding:"6px 8px",borderRadius:7,border:`1px solid ${C.border}`,background:"transparent",color:C.accent,fontSize:10,fontWeight:600,display:"flex",alignItems:"center",gap:7,marginBottom:3}}>
            <span>âš™</span><span className="sb-label">Settings & Integrations</span>
          </button>
          <button onClick={()=>setSidebar(o=>!o)} style={{width:"100%",padding:"5px 8px",borderRadius:7,border:"none",background:"transparent",color:C.t3,fontSize:11,display:"flex",alignItems:"center",gap:7}}>
            <span style={{fontSize:10}}>{sidebar?"â—€":"â–¶"}</span><span className="sb-label">Collapse</span>
          </button>
        </div>
      </div>

      {/* â”€â”€ MAIN â”€â”€ */}
      <div style={{flex:1,display:"flex",flexDirection:"column",overflow:"hidden",minWidth:0}}>
        <div style={{padding:"9px 16px",borderBottom:`1px solid ${C.border}`,display:"flex",alignItems:"center",gap:8,background:C.card,flexShrink:0,flexWrap:"wrap"}}>
          <div style={{flex:1,minWidth:0}}>
            <div style={{fontSize:14,fontWeight:700,color:C.text,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>
              {V?.icon} {V?.label}
              {section!=="all"&&<span style={{fontSize:12,color:SEC.color,marginLeft:7,fontWeight:500}}>Â· {SEC.label}</span>}
            </div>
            <div style={{fontSize:9,color:C.t3}}>{new Date().toLocaleDateString("en-US",{weekday:"long",month:"long",day:"numeric",year:"numeric"})}</div>
          </div>
          <button onClick={()=>setShowCapture(true)} style={{padding:"6px 11px",borderRadius:8,border:`1px solid ${C.accent}`,background:C.accent+"10",color:C.accent,fontSize:12,fontWeight:600,display:"flex",alignItems:"center",gap:5,whiteSpace:"nowrap"}}>
            <span>+</span> Quick Capture
          </button>
        </div>

        <div className="main-content" style={{flex:1,overflowY:"auto",padding:"14px 16px"}}>
          {view==="dashboard"&&<Dashboard items={active} todos={todos} decisions={decisions} onEdit={openEdit} settings={settings} onNav={navTo} onDebrief={()=>openDebrief(null)}/>}
          {view==="prep"    &&<MeetingPrep items={active} onEdit={openEdit} onStartNote={startNoteFromPrep} onDebrief={openDebrief}/>}
          {view==="notes"   &&<Notes section={section} items={active} settings={settings} onSave={saveNote} onEdit={openEdit} initTmpl={prepTmpl} clearTmpl={()=>setPrepTmpl(null)}/>}
          {view==="cards"   &&<Cards items={sectionItems} settings={settings} onEdit={openEdit} onDelete={deleteItem} onCycle={cycleStatus} onArchive={archiveItem} all={active}/>}
          {view==="decisions"&&<DecisionLog decisions={decisions} onAdd={d=>setDecisions([d,...decisions])} onUpdate={d=>setDecisions(decisions.map(x=>x.id===d.id?d:x))} onDelete={id=>setDecisions(decisions.filter(d=>d.id!==id))}/>}
          {view==="search"  &&<Search items={items} todos={todos} decisions={decisions} settings={settings} onEdit={openEdit}/>}
          {view==="history" &&<History items={active} onEdit={openEdit}/>}
          {view==="archive" &&<Archive items={items} onUnarchive={unarchiveItem} onDelete={deleteItem}/>}
          {view==="todo"    &&<Todo items={active} todos={todos} onChange={setTodos}/>}
          {view==="gantt"   &&<Gantt items={sectionItems} settings={settings}/>}
          {view==="calendar"&&<Cal items={sectionItems} settings={settings} onEdit={openEdit}/>}
          {view==="monitor" &&<Monitor settings={settings} onOpenSettings={()=>setShowSettings(true)}/>}
        </div>
      </div>

      {showCapture &&<QuickCapture onSave={handleQuickSave} onClose={()=>setShowCapture(false)}/> }
      {showDebrief &&<PostMeetingDebrief items={items} onSave={handleDebriefSave} onClose={()=>{setShowDebrief(false);setDebriefTmpl(null);}} initTmpl={debriefTmpl}/>}
      {editItem    &&<EditModal item={editItem} onSave={saveEdit} onClose={()=>setEditItem(null)} all={items}/>}
      {showSettings&&<Settings settings={settings} onSave={setSettings} onClose={()=>setShowSettings(false)} items={items} todos={todos}/>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
